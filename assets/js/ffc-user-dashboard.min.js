!function(e){"use strict";var t='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#4285F4" stroke-width="1.5"/><path d="M1 5h14" stroke="#4285F4" stroke-width="1.5"/><circle cx="5" cy="9" r="1.2" fill="#EA4335"/><circle cx="8" cy="9" r="1.2" fill="#FBBC04"/><circle cx="11" cy="9" r="1.2" fill="#34A853"/><path d="M5 1v3M11 1v3" stroke="#4285F4" stroke-width="1.5" stroke-linecap="round"/></svg>',a='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#0078D4" stroke-width="1.5"/><path d="M1 5h14" stroke="#0078D4" stroke-width="1.5"/><rect x="4" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4"/><rect x="9" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4" opacity="0.5"/><path d="M5 1v3M11 1v3" stroke="#0078D4" stroke-width="1.5" stroke-linecap="round"/></svg>',s='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 10V3M8 10l-2.5-2.5M8 10l2.5-2.5" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12h10" stroke="#666" stroke-width="1.5" stroke-linecap="round"/></svg>',r='<svg width="14" height="14" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="none" stroke="#fff" stroke-width="1.5"/><path d="M1 7h14" stroke="#fff" stroke-width="1.2"/><path d="M5 1v3M11 1v3" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>';function n(e){return e<10?"0"+e:""+e}function i(e){if(!e)return{h:0,m:0};var t=e.split(":");return{h:parseInt(t[0],10)||0,m:parseInt(t[1],10)||0}}function o(e,t){var a=e.replace(/-/g,""),s=i(t);return a+"T"+n(s.h)+n(s.m)+"00"}function f(e,t){return o(e,t)}function c(e,t){var a=i(t);return e+"T"+n(a.h)+":"+n(a.m)+":00"}function d(e){return e?e.replace(/\\/g,"\\\\").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;"):""}function l(e){var t=function(e){var t=window.location.hostname,a=(e.uid||"ffc-"+Date.now())+"@"+t,s=(new Date).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),r="BEGIN:VCALENDAR\r\n";return r+="VERSION:2.0\r\n",r+="PRODID:-//"+(ffcDashboard.siteName||t)+"//FFC//PT\r\n",r+="CALSCALE:GREGORIAN\r\n",r+="METHOD:PUBLISH\r\n",r+="BEGIN:VEVENT\r\n",r+="UID:"+a+"\r\n",r+="DTSTAMP:"+s+"\r\n",r+="DTSTART:"+o(e.date,e.startTime)+"\r\n",r+="DTEND:"+o(e.date,e.endTime)+"\r\n",r+="SUMMARY:"+d(e.summary)+"\r\n",e.description&&(r+="DESCRIPTION:"+d(e.description)+"\r\n"),e.location&&(r+="LOCATION:"+d(e.location)+"\r\n"),r+="STATUS:CONFIRMED\r\n",r+="END:VEVENT\r\n",r+"END:VCALENDAR\r\n"}(e),a=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=(e.summary||"event").replace(/[^a-zA-Z0-9\u00C0-\u024F]/g,"_").substring(0,50)+".ics",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}function p(e){var n=function(e){var t=f(e.date,e.startTime)+"/"+f(e.date,e.endTime),a={action:"TEMPLATE",text:e.summary,dates:t,details:e.description||""};e.location&&(a.location=e.location),ffcDashboard.wpTimezone&&(a.ctz=ffcDashboard.wpTimezone);var s=[];for(var r in a)a.hasOwnProperty(r)&&s.push(encodeURIComponent(r)+"="+encodeURIComponent(a[r]));return"https://calendar.google.com/calendar/render?"+s.join("&")}(e),i=function(e){var t={rru:"addevent",subject:e.summary,startdt:c(e.date,e.startTime),enddt:c(e.date,e.endTime),body:e.description||"",path:"/calendar/action/compose"};e.location&&(t.location=e.location);var a=[];for(var s in t)t.hasOwnProperty(s)&&a.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return"https://outlook.live.com/calendar/0/deeplink/compose?"+a.join("&")}(e),o=JSON.stringify(e).replace(/'/g,"&#39;").replace(/"/g,"&quot;"),d='<div class="ffc-cal-export-wrap">';return d+='<button type="button" class="ffc-cal-export-btn">',d+=r+" ",d+=ffcDashboard.strings.exportToCalendar||"Exportar para Calendario",d+=" &#9662;</button>",d+='<div class="ffc-cal-export-dropdown">',d+='<a href="'+n+'" target="_blank" rel="noopener noreferrer">'+t+" Google Calendar</a>",d+='<a href="'+i+'" target="_blank" rel="noopener noreferrer">'+a+" Outlook</a>",d+='<a href="#" class="ffc-cal-export-ics" data-event="'+o+'">'+s+" "+(ffcDashboard.strings.otherIcs||"Outros (.ics)")+"</a>",d+="</div></div>"}function u(t){return e("<div>").text(t||"").html()}function h(){var e=parseInt(localStorage.getItem("ffc_page_size"),10);return e&&-1!==[10,25,50].indexOf(e)?e:25}function v(e){var t=ffcDashboard.strings,a='<div class="ffc-filter-bar" data-tab="'+e+'">';return a+="<label>"+(t.filterFrom||"From:")+' <input type="date" class="ffc-filter-from" /></label>',a+="<label>"+(t.filterTo||"To:")+' <input type="date" class="ffc-filter-to" /></label>',a+='<input type="text" class="ffc-filter-search" placeholder="'+(t.filterSearch||"Search...")+'" />',a+='<button type="button" class="button ffc-filter-apply">'+(t.filterApply||"Filter")+"</button>",a+='<button type="button" class="button ffc-filter-clear">'+(t.filterClear||"Clear")+"</button>",a+="</div>"}function b(){var e=h(),t='<span class="ffc-page-size-select">'+(ffcDashboard.strings.perPage||"Per page:")+" ";return[10,25,50].forEach(function(a){t+=a===e?"<strong>"+a+"</strong> ":'<a href="#" class="ffc-page-size-btn" data-size="'+a+'">'+a+"</a> "}),t+="</span>"}var m={init:function(){this.bindEvents(),this.loadSummary(),this.loadInitialTab()},bindEvents:function(){e(document).on("click",".ffc-tab",this.switchTab.bind(this)),e(document).on("keydown",".ffc-tab",this.handleTabKeydown.bind(this)),e(document).on("click",".ffc-pagination-btn",this.handlePagination.bind(this)),e(document).on("click",".ffc-cal-export-btn",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).siblings(".ffc-cal-export-dropdown");e(".ffc-cal-export-dropdown.open").not(a).removeClass("open"),a.toggleClass("open")}),e(document).on("click",".ffc-cal-export-ics",function(t){t.preventDefault();var a=e(this).data("event");a&&l(a),e(this).closest(".ffc-cal-export-dropdown").removeClass("open")}),e(document).on("click",function(){e(".ffc-cal-export-dropdown.open").removeClass("open")}),e(document).on("click",".ffc-cal-export-dropdown",function(e){e.stopPropagation()}),e(document).on("click",".ffc-profile-edit-btn",function(e){e.preventDefault(),m.showProfileEditForm()}),e(document).on("click",".ffc-profile-save-btn",function(e){e.preventDefault(),m.saveProfile()}),e(document).on("click",".ffc-profile-cancel-btn",function(e){e.preventDefault(),m._profileData&&m.renderProfile(m._profileData)}),e(document).on("click",".ffc-password-save-btn",function(e){e.preventDefault(),m.changePassword()}),e(document).on("click",".ffc-password-toggle-btn",function(t){t.preventDefault(),e("#tab-profile .ffc-password-form").slideToggle(200)}),e(document).on("click",".ffc-lgpd-export-btn",function(e){e.preventDefault(),m.privacyRequest("export_personal_data")}),e(document).on("click",".ffc-lgpd-delete-btn",function(e){e.preventDefault(),confirm(ffcDashboard.strings.confirmDeletion||"Are you sure?")&&m.privacyRequest("remove_personal_data")}),e(document).on("click",".ffc-cancel-appointment",function(t){t.preventDefault(),m.cancelAppointment(e(this).data("id"))}),e(document).on("click",".ffc-audience-join-btn",function(t){t.preventDefault();var a=e(this).data("id");m.joinAudienceGroup(a)}),e(document).on("click",".ffc-audience-leave-btn",function(t){t.preventDefault();var a=e(this).data("id");m.leaveAudienceGroup(a)}),e(document).on("change",".ffc-notif-toggle",function(){m.saveNotificationPreferences()}),e(document).on("click",".ffc-filter-apply",function(t){t.preventDefault();var a=e(this).closest(".ffc-filter-bar").data("tab");m.applyTabFilter(a)}),e(document).on("click",".ffc-filter-clear",function(t){t.preventDefault();var a=e(this).closest(".ffc-filter-bar");a.find("input").val("");var s=a.data("tab");m.applyTabFilter(s)}),e(document).on("keyup",".ffc-filter-search",function(t){if("Enter"===t.key){var a=e(this).closest(".ffc-filter-bar").data("tab");m.applyTabFilter(a)}}),e(document).on("click",".ffc-page-size-btn",function(t){t.preventDefault();var a=parseInt(e(this).data("size"),10);localStorage.setItem("ffc_page_size",a);var s=e(".ffc-tab.active").data("tab");m.applyTabFilter(s)})},loadSummary:function(){var t=e("#ffc-dashboard-summary");if(0!==t.length){var a=ffcDashboard.restUrl+"user/summary";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m.renderSummary(e)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}},renderSummary:function(t){var a=e("#ffc-dashboard-summary"),s=ffcDashboard.strings,r="";ffcDashboard.canViewCertificates&&(r+='<div class="ffc-summary-card">',r+='<div class="ffc-summary-number">'+(t.total_certificates||0)+"</div>",r+='<div class="ffc-summary-label">'+(s.totalCertificates||"Certificates")+"</div>",r+="</div>"),ffcDashboard.canViewAppointments&&(r+='<div class="ffc-summary-card">',t.next_appointment?(r+='<div class="ffc-summary-number ffc-summary-date">'+t.next_appointment.date+"</div>",r+='<div class="ffc-summary-detail">'+t.next_appointment.time+" &mdash; "+u(t.next_appointment.title)+"</div>"):r+='<div class="ffc-summary-number">&mdash;</div>',r+='<div class="ffc-summary-label">'+(s.nextAppointment||"Next Appointment")+"</div>",r+="</div>"),ffcDashboard.canViewAudienceBookings&&(r+='<div class="ffc-summary-card">',r+='<div class="ffc-summary-number">'+(t.upcoming_group_events||0)+"</div>",r+='<div class="ffc-summary-label">'+(s.upcomingGroupEvents||"Group Events")+"</div>",r+="</div>"),a.html(r)},loadInitialTab:function(){var t=e(".ffc-tab.active").data("tab");"certificates"===t?this.loadCertificates():"appointments"===t?this.loadAppointments():"audience"===t?this.loadAudienceBookings():"reregistrations"===t?this.loadReregistrations():"profile"===t&&this.loadProfile()},switchTab:function(t){t.preventDefault();var a=e(t.currentTarget),s=a.data("tab");if(e(".ffc-tab").removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),a.addClass("active").attr("aria-selected","true").attr("tabindex","0"),e(".ffc-tab-content").removeClass("active"),e("#tab-"+s).addClass("active"),history.pushState){var r=new URL(window.location);r.searchParams.set("tab",s),history.pushState({},"",r)}"certificates"===s?this.loadCertificates():"appointments"===s?this.loadAppointments():"audience"===s?this.loadAudienceBookings():"reregistrations"===s?this.loadReregistrations():"profile"===s&&this.loadProfile()},handleTabKeydown:function(t){var a=e(".ffc-tab"),s=e(t.currentTarget),r=a.index(s),n=-1;"ArrowRight"===t.key||"ArrowDown"===t.key?(t.preventDefault(),n=(r+1)%a.length):"ArrowLeft"===t.key||"ArrowUp"===t.key?(t.preventDefault(),n=(r-1+a.length)%a.length):"Home"===t.key?(t.preventDefault(),n=0):"End"===t.key&&(t.preventDefault(),n=a.length-1),n>=0&&a.eq(n).focus().trigger("click")},applyTabFilter:function(e){"certificates"===e&&this._certificatesData?this.renderCertificates(this._certificatesData,1):"appointments"===e&&this._appointmentsData?this.renderAppointments(this._appointmentsData,1):"audience"===e&&this._audienceData?this.renderAudienceBookings(this._audienceData,1):"reregistrations"===e&&this._reregistrationsData&&this.renderReregistrations(this._reregistrationsData,1)},buildPagination:function(e,t,a){var s=h();if(e<=s)return'<div class="ffc-pagination">'+b()+"</div>";var r=Math.ceil(e/s),n='<div class="ffc-pagination">';return t>1&&(n+='<button class="button ffc-pagination-btn" data-page="'+(t-1)+'" data-target="'+a+'">&laquo; '+(ffcDashboard.strings.previous||"Previous")+"</button> "),n+='<span class="ffc-pagination-info">',n+=(ffcDashboard.strings.pageOf||"Page {current} of {total}").replace("{current}",t).replace("{total}",r),n+="</span>",t<r&&(n+=' <button class="button ffc-pagination-btn" data-page="'+(t+1)+'" data-target="'+a+'">'+(ffcDashboard.strings.next||"Next")+" &raquo;</button>"),n+=" "+b(),n+="</div>"},handlePagination:function(t){t.preventDefault();var a=e(t.currentTarget),s=parseInt(a.data("page"),10),r=a.data("target");"certificates"===r?this.renderCertificates(this._certificatesData,s):"appointments"===r?this.renderAppointments(this._appointmentsData,s):"audience"===r?this.renderAudienceBookings(this._audienceData,s):"reregistrations"===r&&this.renderReregistrations(this._reregistrationsData,s)},_certificatesData:null,loadCertificates:function(){var t=e("#tab-certificates");if(0!==t.length)if(void 0===ffcDashboard.canViewCertificates||ffcDashboard.canViewCertificates){if(null===this._certificatesData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/certificates";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m._certificatesData=e.certificates||[],m.renderCertificates(m._certificatesData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderCertificates:function(t,a){var s=e("#tab-certificates");a=a||1;var r=h(),n=v("certificates"),i=s.find(".ffc-filter-bar"),o=i.find(".ffc-filter-from").val()||"",f=i.find(".ffc-filter-to").val()||"",c=i.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||f||c)&&(d=t.filter(function(e){if(o&&e.submission_date_raw<o)return!1;if(f&&e.submission_date_raw>f)return!1;if(c&&-1===(e.form_title+" "+e.email+" "+e.auth_code).toLowerCase().indexOf(c.toLowerCase()))return!1;return!0}));var l=(a-1)*r,p=d.slice(l,l+r),u=n;u+='<table class="ffc-certificates-table">',u+="<thead><tr>",u+="<th>"+ffcDashboard.strings.eventName+"</th>",u+="<th>"+ffcDashboard.strings.date+"</th>",u+="<th>"+ffcDashboard.strings.consent+"</th>",u+="<th>"+ffcDashboard.strings.email+"</th>",u+="<th>"+ffcDashboard.strings.code+"</th>",u+="<th>"+ffcDashboard.strings.actions+"</th>",u+="</tr></thead><tbody>",p.forEach(function(e){u+="<tr>",u+="<td>"+e.form_title+"</td>",u+="<td>"+e.submission_date+"</td>",u+='<td><span class="'+(e.consent_given?"consent-yes":"consent-no")+'">',u+=e.consent_given?ffcDashboard.strings.yes:ffcDashboard.strings.no,u+="</span></td>",u+="<td>"+e.email+"</td>",u+="<td>"+e.auth_code+"</td>",u+="<td>",e.magic_link&&(u+='<a href="'+e.magic_link+'" class="button ffc-btn-pdf" target="_blank">'+ffcDashboard.strings.downloadPdf+"</a>"),u+="</td>",u+="</tr>"}),u+="</tbody></table>",u+=this.buildPagination(d.length,a,"certificates"),s.html(u),s.find(".ffc-filter-from").val(o),s.find(".ffc-filter-to").val(f),s.find(".ffc-filter-search").val(c)}else s.html(n+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noCertificates+"</p></div>")},_appointmentsData:null,loadAppointments:function(){var t=e("#tab-appointments");if(0!==t.length)if(void 0===ffcDashboard.canViewAppointments||ffcDashboard.canViewAppointments){if(null===this._appointmentsData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/appointments";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m._appointmentsData=e.appointments||[],m.renderAppointments(m._appointmentsData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAppointments:function(t,a){var s=e("#tab-appointments");a=a||1;var r=h(),n=v("appointments"),i=s.find(".ffc-filter-bar"),o=i.find(".ffc-filter-from").val()||"",f=i.find(".ffc-filter-to").val()||"",c=i.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||f||c)&&(d=t.filter(function(e){if(o&&e.appointment_date_raw<o)return!1;if(f&&e.appointment_date_raw>f)return!1;if(c&&-1===(e.calendar_title+" "+e.status_label).toLowerCase().indexOf(c.toLowerCase()))return!1;return!0}));var l=(new Date).toISOString().slice(0,10),u=[],b=[],m=[];d.forEach(function(e){"cancelled"===e.status?m.push(e):e.appointment_date_raw<l||"completed"===e.status||"no_show"===e.status?b.push(e):u.push(e)});var g=[];u.forEach(function(e){e._section="upcoming",g.push(e)}),b.forEach(function(e){e._section="past",g.push(e)}),m.forEach(function(e){e._section="cancelled",g.push(e)});var D=(a-1)*r,w=g.slice(D,D+r),_=n,y="";w.forEach(function(e){var t=e._section;if(t!==y){""!==y&&(_+="</tbody></table>"),y=t;var a="",s=!1;"upcoming"===t?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===t?(a=ffcDashboard.strings.past||"Past",s=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",s=!0),_+="<h3"+("upcoming"!==t?' style="margin-top: 30px;"':"")+">"+a+"</h3>",_+='<table class="ffc-appointments-table'+(s?" past-appointments":"")+'">',_+="<thead><tr>",_+="<th>"+ffcDashboard.strings.calendar+"</th>",_+="<th>"+ffcDashboard.strings.date+"</th>",_+="<th>"+ffcDashboard.strings.time+"</th>",_+="<th>"+ffcDashboard.strings.status+"</th>",_+="<th>"+ffcDashboard.strings.actions+"</th>",_+="</tr></thead><tbody>"}var r="";if("cancelled"===e.status?r="cancelled-row":"past"===t&&(r="past-row"),_+="<tr"+(r?' class="'+r+'"':"")+">",_+="<td>"+e.calendar_title+"</td>",_+="<td>"+e.appointment_date+"</td>",_+="<td>"+e.start_time+"</td>",_+='<td><span class="appointment-status status-'+e.status+'">'+e.status_label+"</span></td>",_+="<td>",e.receipt_url&&(_+='<a href="'+e.receipt_url+'" class="button ffc-btn-receipt" target="_blank">'+(ffcDashboard.strings.viewReceipt||"View Receipt")+"</a>"),e.can_cancel&&(_+='<button class="button ffc-cancel-appointment" data-id="'+e.id+'">'+ffcDashboard.strings.cancelAppointment+"</button>"),"upcoming"===t&&"confirmed"===e.status){var n={uid:"ffc-apt-"+e.id,summary:e.calendar_title,description:e.calendar_title+(e.name?"\n"+(ffcDashboard.strings.name||"Nome:")+" "+e.name:"")+(e.email?"\n"+(ffcDashboard.strings.email||"Email:")+" "+e.email:""),location:ffcDashboard.mainAddress||"",date:e.appointment_date_raw,startTime:e.start_time_raw,endTime:e.end_time||e.start_time_raw};_+=" "+p(n)}_+="</td></tr>"}),""!==y&&(_+="</tbody></table>"),_+=this.buildPagination(g.length,a,"appointments"),s.html(_),s.find(".ffc-filter-from").val(o),s.find(".ffc-filter-to").val(f),s.find(".ffc-filter-search").val(c)}else s.html(n+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noAppointments+"</p></div>")},_audienceData:null,loadAudienceBookings:function(){var t=e("#tab-audience");if(0!==t.length)if(void 0===ffcDashboard.canViewAudienceBookings||ffcDashboard.canViewAudienceBookings){if(null===this._audienceData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/audience-bookings";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m._audienceData=e.bookings||[],m.renderAudienceBookings(m._audienceData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAudienceBookings:function(t,a){var s=e("#tab-audience");a=a||1;var r=h(),n=v("audience"),i=s.find(".ffc-filter-bar"),o=i.find(".ffc-filter-from").val()||"",f=i.find(".ffc-filter-to").val()||"",c=i.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||f||c)&&(d=t.filter(function(e){if(o&&e.booking_date_raw<o)return!1;if(f&&e.booking_date_raw>f)return!1;if(c&&-1===(e.environment_name+" "+e.schedule_name+" "+e.description).toLowerCase().indexOf(c.toLowerCase()))return!1;return!0}));var l=d.filter(function(e){return!e.is_past&&"cancelled"!==e.status}),b=d.filter(function(e){return e.is_past&&"cancelled"!==e.status}),m=d.filter(function(e){return"cancelled"===e.status}),g=[].concat(l,b,m),D=(a-1)*r,w=g.slice(D,D+r),_=n,y="";w.forEach(function(e){var t;if((t="cancelled"===e.status?"cancelled":e.is_past?"past":"upcoming")!==y){""!==y&&(_+="</tbody></table>"),y=t;var a,s=!1;"upcoming"===t?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===t?(a=ffcDashboard.strings.past||"Past",s=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",s=!0),_+="<h3"+("upcoming"!==y?' style="margin-top: 30px;"':"")+">"+a+"</h3>",_+='<table class="ffc-audience-bookings-table'+(s?" past-bookings":"")+'">',_+="<thead><tr>",_+="<th>"+(ffcDashboard.strings.environment||"Environment")+"</th>",_+="<th>"+(ffcDashboard.strings.date||"Date")+"</th>",_+="<th>"+(ffcDashboard.strings.time||"Time")+"</th>",_+="<th>"+(ffcDashboard.strings.description||"Description")+"</th>",_+="<th>"+(ffcDashboard.strings.audiences||"Audiences")+"</th>",_+="<th>"+(ffcDashboard.strings.actions||"Actions")+"</th>",_+="</tr></thead><tbody>"}var r="";if("cancelled"===e.status?r="cancelled-row":e.is_past&&(r="past-row"),_+="<tr"+(r?' class="'+r+'"':"")+">",_+="<td>"+e.environment_name,e.schedule_name&&(_+='<br><small style="color: #666;">'+e.schedule_name+"</small>"),_+="</td>",_+="<td>"+e.booking_date+"</td>",_+="<td>"+e.start_time+" - "+e.end_time+"</td>",_+="<td>"+(e.description||"")+"</td>",_+="<td>",e.audiences&&e.audiences.length>0&&e.audiences.forEach(function(e){_+='<span class="ffc-audience-tag" style="background-color: '+u(e.color)+'; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 12px;">'+u(e.name)+"</span>"}),_+="</td>",_+="<td>","upcoming"===t&&"cancelled"!==e.status){var n=e.audiences?e.audiences.map(function(e){return e.name}).join(", "):"",i={uid:"ffc-booking-"+e.id,summary:e.description||e.environment_name,description:(e.environment_name?(ffcDashboard.strings.environment||"Ambiente")+": "+e.environment_name:"")+(e.schedule_name?"\n"+e.schedule_name:"")+(e.description?"\n"+e.description:"")+(n?"\n"+(ffcDashboard.strings.audiences||"Audiencias")+": "+n:""),location:e.environment_name||"",date:e.booking_date_raw,startTime:e.start_time,endTime:e.end_time||e.start_time};_+=p(i)}_+="</td></tr>"}),""!==y&&(_+="</tbody></table>"),_+=this.buildPagination(g.length,a,"audience"),s.html(_),s.find(".ffc-filter-from").val(o),s.find(".ffc-filter-to").val(f),s.find(".ffc-filter-search").val(c)}else s.html(n+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noAudienceBookings+"</p></div>")},_reregistrationsData:null,loadReregistrations:function(){var t=e("#tab-reregistrations");if(0!==t.length)if(void 0===ffcDashboard.canViewReregistrations||ffcDashboard.canViewReregistrations){if(null===this._reregistrationsData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/reregistrations";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m._reregistrationsData=e.reregistrations||[],m.renderReregistrations(m._reregistrationsData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderReregistrations:function(t,a){var s=e("#tab-reregistrations");a=a||1;var r=h(),n=ffcDashboard.strings,i=v("reregistrations"),o=s.find(".ffc-filter-bar"),f=o.find(".ffc-filter-from").val()||"",c=o.find(".ffc-filter-to").val()||"",d=o.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var l=t;(f||c||d)&&(l=t.filter(function(e){if(f&&e.start_date<f)return!1;if(c&&e.end_date>c)return!1;if(d&&-1===(e.title+" "+e.status_label+" "+(e.auth_code||"")).toLowerCase().indexOf(d.toLowerCase()))return!1;return!0}));var p=l.filter(function(e){return e.is_active}),b=l.filter(function(e){return!e.is_active}),m=[];p.forEach(function(e){e._section="active",m.push(e)}),b.forEach(function(e){e._section="completed",m.push(e)});var g=(a-1)*r,D=m.slice(g,g+r),w=i,_="";D.forEach(function(e){var t=e._section;if(t!==_){""!==_&&(w+="</tbody></table>"),_=t;var a="active"===t?n.active||"Active":n.completed||"Completed";w+="<h3"+("active"!==t?' style="margin-top: 30px;"':"")+">"+a+"</h3>",w+='<table class="ffc-reregistrations-table'+("active"!==t?" past-reregistrations":"")+'">',w+="<thead><tr>",w+="<th>"+(n.reregistrationTitle||"Campaign")+"</th>",w+="<th>"+(n.period||"Period")+"</th>",w+="<th>"+(n.status||"Status")+"</th>",w+="<th>"+(n.submittedAt||"Submitted")+"</th>",w+="<th>"+(n.validationCode||"Validation Code")+"</th>",w+="<th>"+(n.actions||"Actions")+"</th>",w+="</tr></thead><tbody>"}w+="<tr"+("active"!==t?' class="past-row"':"")+">",w+="<td>"+u(e.title)+"</td>",w+="<td>"+u(e.start_date_formatted)+" &mdash; "+u(e.end_date_formatted)+"</td>",w+='<td><span class="appointment-status status-'+e.status+'">'+u(e.status_label)+"</span></td>",w+="<td>"+u(e.submitted_at||"—")+"</td>",w+="<td>",e.auth_code?w+='<code class="ffc-auth-code">'+u(e.auth_code)+"</code>":w+="—",w+="</td>",w+="<td>",e.can_submit&&(w+='<button type="button" class="button ffc-btn-edit ffc-rereg-open-form" data-reregistration-id="'+e.reregistration_id+'">'+(n.editReregistration||"Edit")+"</button> "),e.can_download&&e.magic_link&&(w+='<a href="'+u(e.magic_link)+'" class="button ffc-btn-pdf" target="_blank" rel="noopener">'+(n.downloadFicha||"Download Ficha")+"</a>"),w+="</td>",w+="</tr>"}),""!==_&&(w+="</tbody></table>"),w+=this.buildPagination(m.length,a,"reregistrations"),s.html(w),s.find(".ffc-filter-from").val(f),s.find(".ffc-filter-to").val(c),s.find(".ffc-filter-search").val(d)}else s.html(i+'<div class="ffc-empty-state"><p>'+(n.noReregistrations||"No reregistrations found.")+"</p></div>")},cancelAppointment:function(t){if(confirm(ffcDashboard.strings.confirmCancel)){var a={action:"ffc_cancel_appointment",appointment_id:t,nonce:ffcDashboard.schedulingNonce};ffcDashboard.viewAsUserId&&(a.viewAsUserId=ffcDashboard.viewAsUserId),e.ajax({url:ffcDashboard.ajaxUrl,method:"POST",data:a,success:function(t){t.success?(alert(ffcDashboard.strings.cancelSuccess),m._appointmentsData=null,e("#tab-appointments").html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>"),m.loadAppointments()):alert(t.data.message||ffcDashboard.strings.cancelError)},error:function(){alert(ffcDashboard.strings.cancelError)}})}},loadProfile:function(){var t=e("#tab-profile");if(!(t.find(".ffc-profile-info").length>0)){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m.renderProfile(e)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}},_profileData:null,renderProfile:function(t){var a=e("#tab-profile");this._profileData=t;var s=ffcDashboard.strings,r="";ffcDashboard.logoutUrl&&(r+='<div class="ffc-profile-logout"><a href="'+ffcDashboard.logoutUrl+'" class="ffc-logout-link"><span class="ffc-icon-logout" aria-hidden="true"></span>'+(s.logout||"Log Out")+"</a></div>"),r+='<div class="ffc-profile-info">',r+='<div class="ffc-profile-field">',r+="<label>"+s.name+"</label>",t.names&&t.names.length>1?(r+='<ul class="name-list">',t.names.forEach(function(e){r+="<li>"+u(e)+"</li>"}),r+="</ul>"):t.names&&1===t.names.length?r+='<div class="value">'+u(t.names[0])+"</div>":r+='<div class="value">'+u(t.display_name||"-")+"</div>",r+="</div>",r+='<div class="ffc-profile-field">',r+="<label>"+s.linkedEmails+"</label>",t.emails&&t.emails.length>1?(r+='<ul class="email-list">',t.emails.forEach(function(e){r+="<li>"+u(e)+"</li>"}),r+="</ul>"):t.emails&&1===t.emails.length?r+='<div class="value">'+u(t.emails[0])+"</div>":r+='<div class="value">'+u(t.email||"-")+"</div>",r+="</div>",r+='<div class="ffc-profile-field">',r+="<label>"+s.cpfRf+"</label>",t.cpfs_masked&&t.cpfs_masked.length>1?(r+='<ul class="cpf-list">',t.cpfs_masked.forEach(function(e){r+="<li>"+u(e)+"</li>"}),r+="</ul>"):t.cpfs_masked&&1===t.cpfs_masked.length?r+='<div class="value">'+u(t.cpfs_masked[0])+"</div>":r+='<div class="value">'+u(t.cpf_masked||"-")+"</div>",r+="</div>",r+='<div class="ffc-profile-field"><label>'+(s.phone||"Phone:")+"</label>",r+='<div class="value">'+u(t.phone||"-")+"</div></div>",r+='<div class="ffc-profile-field"><label>'+(s.department||"Department:")+"</label>",r+='<div class="value">'+u(t.department||"-")+"</div></div>",r+='<div class="ffc-profile-field"><label>'+(s.organization||"Organization:")+"</label>",r+='<div class="value">'+u(t.organization||"-")+"</div></div>",t.notes&&(r+='<div class="ffc-profile-field"><label>'+(s.notesLabel||"Notes:")+"</label>",r+='<div class="value">'+u(t.notes)+"</div></div>"),t.audience_groups&&t.audience_groups.length>0&&(r+='<div class="ffc-profile-field">',r+="<label>"+(s.audienceGroups||"Groups")+"</label>",r+='<div class="value" style="display: flex; flex-wrap: wrap; gap: 6px;">',t.audience_groups.forEach(function(e){r+='<span style="background-color: '+u(e.color||"#2271b1")+'; color: #fff; padding: 4px 12px; border-radius: 3px; font-size: 13px;">'+u(e.name)+"</span>"}),r+="</div></div>"),r+='<div class="ffc-profile-field"><label>'+s.memberSince+"</label>",r+='<div class="value">'+u(t.member_since||"-")+"</div></div>",r+="</div>",r+='<div class="ffc-profile-actions">',r+='<button type="button" class="button button-primary ffc-profile-edit-btn">'+(s.editProfile||"Edit Profile")+"</button>",r+='<button type="button" class="button ffc-password-toggle-btn">'+(s.changePassword||"Change Password")+"</button>",r+="</div>",r+='<div class="ffc-password-form" style="display: none;">',r+='<div class="ffc-profile-field"><label for="ffc-current-password">'+(s.currentPassword||"Current Password")+"</label>",r+='<input type="password" id="ffc-current-password" autocomplete="current-password" /></div>',r+='<div class="ffc-profile-field"><label for="ffc-new-password">'+(s.newPassword||"New Password")+"</label>",r+='<input type="password" id="ffc-new-password" autocomplete="new-password" minlength="8" /></div>',r+='<div class="ffc-profile-field"><label for="ffc-confirm-password">'+(s.confirmPassword||"Confirm New Password")+"</label>",r+='<input type="password" id="ffc-confirm-password" autocomplete="new-password" /></div>',r+='<button type="button" class="button button-primary ffc-password-save-btn">'+(s.save||"Save")+"</button>",r+='<span class="ffc-password-status" style="margin-left: 10px;"></span>',r+="</div>",r+='<div class="ffc-audience-join-section" id="ffc-audience-join-section"></div>',setTimeout(function(){m.loadJoinableGroups()},0);var n=t.preferences||{};r+='<div class="ffc-profile-section">',r+="<h3>"+(s.notificationSection||"Notification Preferences")+"</h3>",r+='<div class="ffc-notif-list">',r+=this._buildToggle("notify_appointment_confirm",s.notifAppointmentConfirm||"Appointment confirmation",n),r+=this._buildToggle("notify_appointment_reminder",s.notifAppointmentReminder||"Appointment reminder",n),r+=this._buildToggle("notify_new_certificate",s.notifNewCertificate||"New certificate issued",n),r+="</div>",r+='<span class="ffc-notif-status" style="margin-left: 10px; color: #28a745; display: none;"></span>',r+="</div>",r+='<div class="ffc-profile-section ffc-lgpd-section">',r+="<h3>"+(s.privacySection||"Privacy & Data (LGPD)")+"</h3>",r+='<p class="ffc-lgpd-desc">'+(s.exportDataDesc||"Request a copy of all your personal data stored in the system.")+"</p>",r+='<button type="button" class="button ffc-lgpd-export-btn">'+(s.exportData||"Export My Data")+"</button>",r+='<p class="ffc-lgpd-desc" style="margin-top: 20px;">'+(s.deletionDataDesc||"Request deletion of your personal data. An administrator will review your request.")+"</p>",r+='<button type="button" class="button ffc-lgpd-delete-btn">'+(s.requestDeletion||"Request Data Deletion")+"</button>",r+='<span class="ffc-lgpd-status" style="margin-left: 10px; display: none;"></span>',r+="</div>",a.html(r)},_buildToggle:function(e,t,a){return'<label class="ffc-toggle-label"><input type="checkbox" class="ffc-notif-toggle" data-key="'+e+'"'+(a[e]?" checked":"")+' /><span class="ffc-toggle-switch"></span><span>'+t+"</span></label>"},showProfileEditForm:function(){var t=e("#tab-profile"),a=this._profileData;if(a){var s='<div class="ffc-profile-edit-form">';s+="<h3>"+(ffcDashboard.strings.editProfile||"Edit Profile")+"</h3>",s+='<div class="ffc-profile-field"><label for="ffc-edit-display-name">'+ffcDashboard.strings.name+"</label>",s+='<input type="text" id="ffc-edit-display-name" value="'+u(a.display_name)+'" maxlength="250" /></div>',s+='<div class="ffc-profile-field"><label for="ffc-edit-phone">'+(ffcDashboard.strings.phone||"Phone:")+"</label>",s+='<input type="tel" id="ffc-edit-phone" value="'+u(a.phone)+'" maxlength="50" /></div>',s+='<div class="ffc-profile-field"><label for="ffc-edit-department">'+(ffcDashboard.strings.department||"Department:")+"</label>",s+='<input type="text" id="ffc-edit-department" value="'+u(a.department)+'" maxlength="250" /></div>',s+='<div class="ffc-profile-field"><label for="ffc-edit-organization">'+(ffcDashboard.strings.organization||"Organization:")+"</label>",s+='<input type="text" id="ffc-edit-organization" value="'+u(a.organization)+'" maxlength="250" /></div>',s+='<div class="ffc-profile-field"><label for="ffc-edit-notes">'+(ffcDashboard.strings.notesLabel||"Notes:")+"</label>",s+='<textarea id="ffc-edit-notes" rows="3" maxlength="1000" placeholder="'+(ffcDashboard.strings.notesPlaceholder||"Personal notes...")+'">'+u(a.notes)+"</textarea></div>",s+='<div class="ffc-profile-edit-actions" style="margin-top: 15px;">',s+='<button type="button" class="button button-primary ffc-profile-save-btn">'+(ffcDashboard.strings.save||"Save")+"</button> ",s+='<button type="button" class="button ffc-profile-cancel-btn">'+(ffcDashboard.strings.cancel||"Cancel")+"</button>",s+='<span class="ffc-profile-save-status" style="margin-left: 10px; display: none;"></span>',s+="</div></div>",t.html(s)}},saveProfile:function(){var t={display_name:e("#ffc-edit-display-name").val(),phone:e("#ffc-edit-phone").val(),department:e("#ffc-edit-department").val(),organization:e("#ffc-edit-organization").val(),notes:e("#ffc-edit-notes").val()},a=e(".ffc-profile-save-btn"),s=e(".ffc-profile-save-status");a.prop("disabled",!0),s.text(ffcDashboard.strings.saving||"Saving...").show().css("color","#666");var r=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(r+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:r,method:"PUT",contentType:"application/json",data:JSON.stringify(t),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m._profileData=null,m.renderProfile(e)},error:function(e){var t=ffcDashboard.strings.saveError||"Error saving profile";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),s.text(t).css("color","#d63638"),a.prop("disabled",!1)}})},loadJoinableGroups:function(){var t=e("#ffc-audience-join-section");if(0!==t.length){var a=ffcDashboard.restUrl+"user/joinable-groups";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m.renderJoinableGroups(e)},error:function(){t.empty()}})}},renderJoinableGroups:function(t){var a=e("#ffc-audience-join-section"),s=t.parents||[];if(0!==s.length){var r=ffcDashboard.strings,n="<h3>"+(r.joinGroups||"Join Groups")+"</h3>";n+='<p class="ffc-audience-limit-msg">'+(r.joinGroupsDesc||"Select up to {max} groups to participate in collective calendars.").replace("{max}",t.max_groups)+"</p>",s.forEach(function(e){n+='<div class="ffc-audience-parent-group">',n+='<div class="ffc-audience-parent-header">',n+='<span class="ffc-audience-dot" style="background-color: '+(e.color||"#2271b1")+';"></span>',n+="<span>"+u(e.name)+"</span>",n+="</div>",n+='<div class="ffc-audience-children-list">',(e.children||[]).forEach(function(a){if(n+='<div class="ffc-audience-join-item'+(a.is_member?" is-member":"")+'" data-group-id="'+a.id+'">',n+='<span class="ffc-audience-name">',n+='<span class="ffc-audience-dot" style="background-color: '+(a.color||e.color||"#2271b1")+';"></span>',n+=u(a.name),n+="</span>",a.is_member)n+='<button type="button" class="button ffc-audience-leave-btn" data-id="'+a.id+'">'+(r.leaveGroup||"Leave")+"</button>";else{var s=t.joined_count>=t.max_groups?" disabled":"";n+='<button type="button" class="button button-primary ffc-audience-join-btn" data-id="'+a.id+'"'+s+">"+(r.joinGroup||"Join")+"</button>"}n+="</div>"}),n+="</div></div>"}),a.html(n)}else a.empty()},joinAudienceGroup:function(t){var a=e('.ffc-audience-join-btn[data-id="'+t+'"]');a.prop("disabled",!0).text(ffcDashboard.strings.saving||"Saving...");var s=ffcDashboard.restUrl+"user/audience-group/join";ffcDashboard.viewAsUserId&&(s+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:s,method:"POST",contentType:"application/json",data:JSON.stringify({group_id:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(){m.reloadProfile()},error:function(e){var t=e.responseJSON&&e.responseJSON.message||ffcDashboard.strings.error||"Error";alert(t),a.prop("disabled",!1).text(ffcDashboard.strings.joinGroup||"Join")}})},leaveAudienceGroup:function(t){if(confirm(ffcDashboard.strings.confirmLeaveGroup||"Leave this group?")){var a=e('.ffc-audience-leave-btn[data-id="'+t+'"]');a.prop("disabled",!0).text(ffcDashboard.strings.saving||"Saving...");var s=ffcDashboard.restUrl+"user/audience-group/leave";ffcDashboard.viewAsUserId&&(s+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:s,method:"POST",contentType:"application/json",data:JSON.stringify({group_id:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(){m.reloadProfile()},error:function(e){var t=e.responseJSON&&e.responseJSON.message||ffcDashboard.strings.error||"Error";alert(t),a.prop("disabled",!1).text(ffcDashboard.strings.leaveGroup||"Leave")}})}},reloadProfile:function(){this._profileData=null;var t=e("#tab-profile");t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){m.renderProfile(e)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})},changePassword:function(){var t=ffcDashboard.strings,a=e("#ffc-current-password").val(),s=e("#ffc-new-password").val(),r=e("#ffc-confirm-password").val(),n=e(".ffc-password-status");if(a&&s&&r)if(s===r)if(s.length<8)n.text(t.passwordTooShort||"Min 8 characters").css("color","#d63638");else{var i=e(".ffc-password-save-btn");i.prop("disabled",!0),n.text(ffcDashboard.strings.saving||"Saving...").css("color","#666");var o=ffcDashboard.restUrl+"user/change-password";ffcDashboard.viewAsUserId&&(o+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:o,method:"POST",contentType:"application/json",data:JSON.stringify({current_password:a,new_password:s}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(a){n.text(a.message||t.passwordChanged||"Password changed!").css("color","#28a745"),e("#ffc-current-password, #ffc-new-password, #ffc-confirm-password").val(""),i.prop("disabled",!1)},error:function(e){var a=t.passwordError||"Error";e.responseJSON&&e.responseJSON.message&&(a=e.responseJSON.message),n.text(a).css("color","#d63638"),i.prop("disabled",!1)}})}else n.text(t.passwordMismatch||"Passwords do not match").css("color","#d63638");else n.text(t.passwordError||"All fields required").css("color","#d63638")},privacyRequest:function(t){var a=e(".ffc-lgpd-status");a.text(ffcDashboard.strings.loading||"Loading...").css("color","#666").show();var s=ffcDashboard.restUrl+"user/privacy-request";ffcDashboard.viewAsUserId&&(s+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:s,method:"POST",contentType:"application/json",data:JSON.stringify({type:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){a.text(e.message||ffcDashboard.strings.privacyRequestSent||"Request sent!").css("color","#28a745")},error:function(e){var t=ffcDashboard.strings.privacyRequestError||"Error";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),a.text(t).css("color","#d63638")}})},saveNotificationPreferences:function(){var t={};e(".ffc-notif-toggle").each(function(){t[e(this).data("key")]=e(this).is(":checked")});var a=e(".ffc-notif-status"),s=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(s+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:s,method:"PUT",contentType:"application/json",data:JSON.stringify({preferences:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){e.preferences&&(m._profileData.preferences=e.preferences),a.text(ffcDashboard.strings.notifSaved||"Saved").show(),setTimeout(function(){a.fadeOut()},2e3)},error:function(){a.text(ffcDashboard.strings.saveError||"Error").css("color","#d63638").show()}})}};e(document).ready(function(){e("#ffc-user-dashboard").length>0&&m.init()})}(jQuery);