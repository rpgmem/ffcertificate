!function(e){"use strict";var t='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#4285F4" stroke-width="1.5"/><path d="M1 5h14" stroke="#4285F4" stroke-width="1.5"/><circle cx="5" cy="9" r="1.2" fill="#EA4335"/><circle cx="8" cy="9" r="1.2" fill="#FBBC04"/><circle cx="11" cy="9" r="1.2" fill="#34A853"/><path d="M5 1v3M11 1v3" stroke="#4285F4" stroke-width="1.5" stroke-linecap="round"/></svg>',a='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#0078D4" stroke-width="1.5"/><path d="M1 5h14" stroke="#0078D4" stroke-width="1.5"/><rect x="4" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4"/><rect x="9" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4" opacity="0.5"/><path d="M5 1v3M11 1v3" stroke="#0078D4" stroke-width="1.5" stroke-linecap="round"/></svg>',n='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 10V3M8 10l-2.5-2.5M8 10l2.5-2.5" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12h10" stroke="#666" stroke-width="1.5" stroke-linecap="round"/></svg>',s='<svg width="14" height="14" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="none" stroke="#fff" stroke-width="1.5"/><path d="M1 7h14" stroke="#fff" stroke-width="1.2"/><path d="M5 1v3M11 1v3" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>';function i(e){return e<10?"0"+e:""+e}function r(e){if(!e)return{h:0,m:0};var t=e.split(":");return{h:parseInt(t[0],10)||0,m:parseInt(t[1],10)||0}}function o(e,t){var a=e.replace(/-/g,""),n=r(t);return a+"T"+i(n.h)+i(n.m)+"00"}function c(e,t){return o(e,t)}function f(e,t){var a=r(t);return e+"T"+i(a.h)+":"+i(a.m)+":00"}function d(e){return e?e.replace(/\\/g,"\\\\").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;"):""}function l(e){var t=function(e){var t=window.location.hostname,a=(e.uid||"ffc-"+Date.now())+"@"+t,n=(new Date).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),s="BEGIN:VCALENDAR\r\n";return s+="VERSION:2.0\r\n",s+="PRODID:-//"+(ffcDashboard.siteName||t)+"//FFC//PT\r\n",s+="CALSCALE:GREGORIAN\r\n",s+="METHOD:PUBLISH\r\n",s+="BEGIN:VEVENT\r\n",s+="UID:"+a+"\r\n",s+="DTSTAMP:"+n+"\r\n",s+="DTSTART:"+o(e.date,e.startTime)+"\r\n",s+="DTEND:"+o(e.date,e.endTime)+"\r\n",s+="SUMMARY:"+d(e.summary)+"\r\n",e.description&&(s+="DESCRIPTION:"+d(e.description)+"\r\n"),e.location&&(s+="LOCATION:"+d(e.location)+"\r\n"),s+="STATUS:CONFIRMED\r\n",s+="END:VEVENT\r\n",s+"END:VCALENDAR\r\n"}(e),a=new Blob([t],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=(e.summary||"event").replace(/[^a-zA-Z0-9\u00C0-\u024F]/g,"_").substring(0,50)+".ics",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}function p(e){var i=function(e){var t=c(e.date,e.startTime)+"/"+c(e.date,e.endTime),a={action:"TEMPLATE",text:e.summary,dates:t,details:e.description||""};e.location&&(a.location=e.location),ffcDashboard.wpTimezone&&(a.ctz=ffcDashboard.wpTimezone);var n=[];for(var s in a)a.hasOwnProperty(s)&&n.push(encodeURIComponent(s)+"="+encodeURIComponent(a[s]));return"https://calendar.google.com/calendar/render?"+n.join("&")}(e),r=function(e){var t={rru:"addevent",subject:e.summary,startdt:f(e.date,e.startTime),enddt:f(e.date,e.endTime),body:e.description||"",path:"/calendar/action/compose"};e.location&&(t.location=e.location);var a=[];for(var n in t)t.hasOwnProperty(n)&&a.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return"https://outlook.live.com/calendar/0/deeplink/compose?"+a.join("&")}(e),o=JSON.stringify(e).replace(/'/g,"&#39;").replace(/"/g,"&quot;"),d='<div class="ffc-cal-export-wrap">';return d+='<button type="button" class="ffc-cal-export-btn">',d+=s+" ",d+=ffcDashboard.strings.exportToCalendar||"Exportar para Calendario",d+=" &#9662;</button>",d+='<div class="ffc-cal-export-dropdown">',d+='<a href="'+i+'" target="_blank" rel="noopener noreferrer">'+t+" Google Calendar</a>",d+='<a href="'+r+'" target="_blank" rel="noopener noreferrer">'+a+" Outlook</a>",d+='<a href="#" class="ffc-cal-export-ics" data-event="'+o+'">'+n+" "+(ffcDashboard.strings.otherIcs||"Outros (.ics)")+"</a>",d+="</div></div>"}function u(t){return e("<div>").text(t||"").html()}function h(){var e=parseInt(localStorage.getItem("ffc_page_size"),10);return e&&-1!==[10,25,50].indexOf(e)?e:25}function b(e){var t=ffcDashboard.strings,a='<div class="ffc-filter-bar" data-tab="'+e+'">';return a+="<label>"+(t.filterFrom||"From:")+' <input type="date" class="ffc-filter-from" /></label>',a+="<label>"+(t.filterTo||"To:")+' <input type="date" class="ffc-filter-to" /></label>',a+='<input type="text" class="ffc-filter-search" placeholder="'+(t.filterSearch||"Search...")+'" />',a+='<button type="button" class="button ffc-filter-apply">'+(t.filterApply||"Filter")+"</button>",a+='<button type="button" class="button ffc-filter-clear">'+(t.filterClear||"Clear")+"</button>",a+="</div>"}function m(){var e=h(),t='<span class="ffc-page-size-select">'+(ffcDashboard.strings.perPage||"Per page:")+" ";return[10,25,50].forEach(function(a){t+=a===e?"<strong>"+a+"</strong> ":'<a href="#" class="ffc-page-size-btn" data-size="'+a+'">'+a+"</a> "}),t+="</span>"}var v={init:function(){this.bindEvents(),this.loadSummary(),this.loadInitialTab()},bindEvents:function(){e(document).on("click",".ffc-tab",this.switchTab.bind(this)),e(document).on("keydown",".ffc-tab",this.handleTabKeydown.bind(this)),e(document).on("click",".ffc-pagination-btn",this.handlePagination.bind(this)),e(document).on("click",".ffc-cal-export-btn",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).siblings(".ffc-cal-export-dropdown");e(".ffc-cal-export-dropdown.open").not(a).removeClass("open"),a.toggleClass("open")}),e(document).on("click",".ffc-cal-export-ics",function(t){t.preventDefault();var a=e(this).data("event");a&&l(a),e(this).closest(".ffc-cal-export-dropdown").removeClass("open")}),e(document).on("click",function(){e(".ffc-cal-export-dropdown.open").removeClass("open")}),e(document).on("click",".ffc-cal-export-dropdown",function(e){e.stopPropagation()}),e(document).on("click",".ffc-profile-edit-btn",function(e){e.preventDefault(),v.showProfileEditForm()}),e(document).on("click",".ffc-profile-save-btn",function(e){e.preventDefault(),v.saveProfile()}),e(document).on("click",".ffc-profile-cancel-btn",function(e){e.preventDefault(),v._profileData&&v.renderProfile(v._profileData)}),e(document).on("click",".ffc-password-save-btn",function(e){e.preventDefault(),v.changePassword()}),e(document).on("click",".ffc-password-toggle-btn",function(t){t.preventDefault(),e("#tab-profile .ffc-password-form").slideToggle(200)}),e(document).on("click",".ffc-lgpd-export-btn",function(e){e.preventDefault(),v.privacyRequest("export_personal_data")}),e(document).on("click",".ffc-lgpd-delete-btn",function(e){e.preventDefault(),confirm(ffcDashboard.strings.confirmDeletion||"Are you sure?")&&v.privacyRequest("remove_personal_data")}),e(document).on("click",".ffc-audience-join-btn",function(t){t.preventDefault();var a=e(this).data("id");v.joinAudienceGroup(a)}),e(document).on("click",".ffc-audience-leave-btn",function(t){t.preventDefault();var a=e(this).data("id");v.leaveAudienceGroup(a)}),e(document).on("change",".ffc-notif-toggle",function(){v.saveNotificationPreferences()}),e(document).on("click",".ffc-filter-apply",function(t){t.preventDefault();var a=e(this).closest(".ffc-filter-bar").data("tab");v.applyTabFilter(a)}),e(document).on("click",".ffc-filter-clear",function(t){t.preventDefault();var a=e(this).closest(".ffc-filter-bar");a.find("input").val("");var n=a.data("tab");v.applyTabFilter(n)}),e(document).on("keyup",".ffc-filter-search",function(t){if("Enter"===t.key){var a=e(this).closest(".ffc-filter-bar").data("tab");v.applyTabFilter(a)}}),e(document).on("click",".ffc-page-size-btn",function(t){t.preventDefault();var a=parseInt(e(this).data("size"),10);localStorage.setItem("ffc_page_size",a);var n=e(".ffc-tab.active").data("tab");v.applyTabFilter(n)})},loadSummary:function(){var t=e("#ffc-dashboard-summary");if(0!==t.length){var a=ffcDashboard.restUrl+"user/summary";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v.renderSummary(e)},error:function(){t.remove()}})}},renderSummary:function(t){var a=e("#ffc-dashboard-summary"),n=ffcDashboard.strings,s="";ffcDashboard.canViewCertificates&&(s+='<div class="ffc-summary-card">',s+='<div class="ffc-summary-number">'+(t.total_certificates||0)+"</div>",s+='<div class="ffc-summary-label">'+(n.totalCertificates||"Certificates")+"</div>",s+="</div>"),ffcDashboard.canViewAppointments&&(s+='<div class="ffc-summary-card">',t.next_appointment?(s+='<div class="ffc-summary-number ffc-summary-date">'+t.next_appointment.date+"</div>",s+='<div class="ffc-summary-detail">'+t.next_appointment.time+" &mdash; "+u(t.next_appointment.title)+"</div>"):s+='<div class="ffc-summary-number">&mdash;</div>',s+='<div class="ffc-summary-label">'+(n.nextAppointment||"Next Appointment")+"</div>",s+="</div>"),ffcDashboard.canViewAudienceBookings&&(s+='<div class="ffc-summary-card">',s+='<div class="ffc-summary-number">'+(t.upcoming_group_events||0)+"</div>",s+='<div class="ffc-summary-label">'+(n.upcomingGroupEvents||"Group Events")+"</div>",s+="</div>"),a.html(s)},loadInitialTab:function(){var t=e(".ffc-tab.active").data("tab");"certificates"===t?this.loadCertificates():"appointments"===t?this.loadAppointments():"audience"===t?this.loadAudienceBookings():"profile"===t&&this.loadProfile()},switchTab:function(t){t.preventDefault();var a=e(t.currentTarget),n=a.data("tab");if(e(".ffc-tab").removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),a.addClass("active").attr("aria-selected","true").attr("tabindex","0"),e(".ffc-tab-content").removeClass("active"),e("#tab-"+n).addClass("active"),history.pushState){var s=new URL(window.location);s.searchParams.set("tab",n),history.pushState({},"",s)}"certificates"===n?this.loadCertificates():"appointments"===n?this.loadAppointments():"audience"===n?this.loadAudienceBookings():"profile"===n&&this.loadProfile()},handleTabKeydown:function(t){var a=e(".ffc-tab"),n=e(t.currentTarget),s=a.index(n),i=-1;"ArrowRight"===t.key||"ArrowDown"===t.key?(t.preventDefault(),i=(s+1)%a.length):"ArrowLeft"===t.key||"ArrowUp"===t.key?(t.preventDefault(),i=(s-1+a.length)%a.length):"Home"===t.key?(t.preventDefault(),i=0):"End"===t.key&&(t.preventDefault(),i=a.length-1),i>=0&&a.eq(i).focus().trigger("click")},applyTabFilter:function(e){"certificates"===e&&this._certificatesData?this.renderCertificates(this._certificatesData,1):"appointments"===e&&this._appointmentsData?this.renderAppointments(this._appointmentsData,1):"audience"===e&&this._audienceData&&this.renderAudienceBookings(this._audienceData,1)},buildPagination:function(e,t,a){var n=h();if(e<=n)return'<div class="ffc-pagination">'+m()+"</div>";var s=Math.ceil(e/n),i='<div class="ffc-pagination">';return t>1&&(i+='<button class="button ffc-pagination-btn" data-page="'+(t-1)+'" data-target="'+a+'">&laquo; '+(ffcDashboard.strings.previous||"Previous")+"</button> "),i+='<span class="ffc-pagination-info">',i+=(ffcDashboard.strings.pageOf||"Page {current} of {total}").replace("{current}",t).replace("{total}",s),i+="</span>",t<s&&(i+=' <button class="button ffc-pagination-btn" data-page="'+(t+1)+'" data-target="'+a+'">'+(ffcDashboard.strings.next||"Next")+" &raquo;</button>"),i+=" "+m(),i+="</div>"},handlePagination:function(t){t.preventDefault();var a=e(t.currentTarget),n=parseInt(a.data("page"),10),s=a.data("target");"certificates"===s?this.renderCertificates(this._certificatesData,n):"appointments"===s?this.renderAppointments(this._appointmentsData,n):"audience"===s&&this.renderAudienceBookings(this._audienceData,n)},_certificatesData:null,loadCertificates:function(){var t=e("#tab-certificates");if(0!==t.length)if(void 0===ffcDashboard.canViewCertificates||ffcDashboard.canViewCertificates){if(null===this._certificatesData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/certificates";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v._certificatesData=e.certificates||[],v.renderCertificates(v._certificatesData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderCertificates:function(t,a){var n=e("#tab-certificates");a=a||1;var s=h(),i=b("certificates"),r=n.find(".ffc-filter-bar"),o=r.find(".ffc-filter-from").val()||"",c=r.find(".ffc-filter-to").val()||"",f=r.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||c||f)&&(d=t.filter(function(e){if(o&&e.submission_date_raw<o)return!1;if(c&&e.submission_date_raw>c)return!1;if(f&&-1===(e.form_title+" "+e.email+" "+e.auth_code).toLowerCase().indexOf(f.toLowerCase()))return!1;return!0}));var l=(a-1)*s,p=d.slice(l,l+s),u=i;u+='<table class="ffc-certificates-table">',u+="<thead><tr>",u+="<th>"+ffcDashboard.strings.eventName+"</th>",u+="<th>"+ffcDashboard.strings.date+"</th>",u+="<th>"+ffcDashboard.strings.consent+"</th>",u+="<th>"+ffcDashboard.strings.email+"</th>",u+="<th>"+ffcDashboard.strings.code+"</th>",u+="<th>"+ffcDashboard.strings.actions+"</th>",u+="</tr></thead><tbody>",p.forEach(function(e){u+="<tr>",u+="<td>"+e.form_title+"</td>",u+="<td>"+e.submission_date+"</td>",u+='<td><span class="'+(e.consent_given?"consent-yes":"consent-no")+'">',u+=e.consent_given?ffcDashboard.strings.yes:ffcDashboard.strings.no,u+="</span></td>",u+="<td>"+e.email+"</td>",u+="<td>"+e.auth_code+"</td>",u+="<td>",e.magic_link&&(u+='<a href="'+e.magic_link+'" class="button ffc-btn-pdf" target="_blank">'+ffcDashboard.strings.downloadPdf+"</a>"),u+="</td>",u+="</tr>"}),u+="</tbody></table>",u+=this.buildPagination(d.length,a,"certificates"),n.html(u),n.find(".ffc-filter-from").val(o),n.find(".ffc-filter-to").val(c),n.find(".ffc-filter-search").val(f)}else n.html(i+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noCertificates+"</p></div>")},_appointmentsData:null,loadAppointments:function(){var t=e("#tab-appointments");if(0!==t.length)if(void 0===ffcDashboard.canViewAppointments||ffcDashboard.canViewAppointments){if(null===this._appointmentsData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/appointments";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v._appointmentsData=e.appointments||[],v.renderAppointments(v._appointmentsData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAppointments:function(t,a){var n=e("#tab-appointments");a=a||1;var s=h(),i=b("appointments"),r=n.find(".ffc-filter-bar"),o=r.find(".ffc-filter-from").val()||"",c=r.find(".ffc-filter-to").val()||"",f=r.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||c||f)&&(d=t.filter(function(e){if(o&&e.appointment_date_raw<o)return!1;if(c&&e.appointment_date_raw>c)return!1;if(f&&-1===(e.calendar_title+" "+e.status_label).toLowerCase().indexOf(f.toLowerCase()))return!1;return!0}));var l=(new Date).toISOString().slice(0,10),u=[],m=[],g=[];d.forEach(function(e){"cancelled"===e.status?g.push(e):e.appointment_date_raw<l||"completed"===e.status||"no_show"===e.status?m.push(e):u.push(e)});var D=[];u.forEach(function(e){e._section="upcoming",D.push(e)}),m.forEach(function(e){e._section="past",D.push(e)}),g.forEach(function(e){e._section="cancelled",D.push(e)});var w=(a-1)*s,y=D.slice(w,w+s),_=i,x="";y.forEach(function(e){var t=e._section;if(t!==x){""!==x&&(_+="</tbody></table>"),x=t;var a="",n=!1;"upcoming"===t?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===t?(a=ffcDashboard.strings.past||"Past",n=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",n=!0),_+="<h3"+("upcoming"!==t?' style="margin-top: 30px;"':"")+">"+a+"</h3>",_+='<table class="ffc-appointments-table'+(n?" past-appointments":"")+'">',_+="<thead><tr>",_+="<th>"+ffcDashboard.strings.calendar+"</th>",_+="<th>"+ffcDashboard.strings.date+"</th>",_+="<th>"+ffcDashboard.strings.time+"</th>",_+="<th>"+ffcDashboard.strings.status+"</th>",_+="<th>"+ffcDashboard.strings.actions+"</th>",_+="</tr></thead><tbody>"}var s="";if("cancelled"===e.status?s="cancelled-row":"past"===t&&(s="past-row"),_+="<tr"+(s?' class="'+s+'"':"")+">",_+="<td>"+e.calendar_title+"</td>",_+="<td>"+e.appointment_date+"</td>",_+="<td>"+e.start_time+"</td>",_+='<td><span class="appointment-status status-'+e.status+'">'+e.status_label+"</span></td>",_+="<td>",e.receipt_url&&(_+='<a href="'+e.receipt_url+'" class="button ffc-btn-receipt" target="_blank">'+(ffcDashboard.strings.viewReceipt||"View Receipt")+"</a>"),e.can_cancel&&(_+='<button class="button ffc-cancel-appointment" data-id="'+e.id+'">'+ffcDashboard.strings.cancelAppointment+"</button>"),"upcoming"===t&&"confirmed"===e.status){var i={uid:"ffc-apt-"+e.id,summary:e.calendar_title,description:e.calendar_title+(e.name?"\n"+(ffcDashboard.strings.name||"Nome:")+" "+e.name:"")+(e.email?"\n"+(ffcDashboard.strings.email||"Email:")+" "+e.email:""),location:ffcDashboard.mainAddress||"",date:e.appointment_date_raw,startTime:e.start_time_raw,endTime:e.end_time||e.start_time_raw};_+=" "+p(i)}_+="</td></tr>"}),""!==x&&(_+="</tbody></table>"),_+=this.buildPagination(D.length,a,"appointments"),n.html(_),n.find(".ffc-filter-from").val(o),n.find(".ffc-filter-to").val(c),n.find(".ffc-filter-search").val(f),n.on("click",".ffc-cancel-appointment",function(t){t.preventDefault(),v.cancelAppointment(e(this).data("id"))})}else n.html(i+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noAppointments+"</p></div>")},_audienceData:null,loadAudienceBookings:function(){var t=e("#tab-audience");if(0!==t.length)if(void 0===ffcDashboard.canViewAudienceBookings||ffcDashboard.canViewAudienceBookings){if(null===this._audienceData){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/audience-bookings";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v._audienceData=e.bookings||[],v.renderAudienceBookings(v._audienceData,1)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else t.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAudienceBookings:function(t,a){var n=e("#tab-audience");a=a||1;var s=h(),i=b("audience"),r=n.find(".ffc-filter-bar"),o=r.find(".ffc-filter-from").val()||"",c=r.find(".ffc-filter-to").val()||"",f=r.find(".ffc-filter-search").val()||"";if(t&&0!==t.length){var d=t;(o||c||f)&&(d=t.filter(function(e){if(o&&e.booking_date_raw<o)return!1;if(c&&e.booking_date_raw>c)return!1;if(f&&-1===(e.environment_name+" "+e.schedule_name+" "+e.description).toLowerCase().indexOf(f.toLowerCase()))return!1;return!0}));var l=d.filter(function(e){return!e.is_past&&"cancelled"!==e.status}),u=d.filter(function(e){return e.is_past&&"cancelled"!==e.status}),m=d.filter(function(e){return"cancelled"===e.status}),v=[].concat(l,u,m),g=(a-1)*s,D=v.slice(g,g+s),w=i,y="";D.forEach(function(e){var t;if((t="cancelled"===e.status?"cancelled":e.is_past?"past":"upcoming")!==y){""!==y&&(w+="</tbody></table>"),y=t;var a,n=!1;"upcoming"===t?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===t?(a=ffcDashboard.strings.past||"Past",n=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",n=!0),w+="<h3"+("upcoming"!==y?' style="margin-top: 30px;"':"")+">"+a+"</h3>",w+='<table class="ffc-audience-bookings-table'+(n?" past-bookings":"")+'">',w+="<thead><tr>",w+="<th>"+(ffcDashboard.strings.environment||"Environment")+"</th>",w+="<th>"+(ffcDashboard.strings.date||"Date")+"</th>",w+="<th>"+(ffcDashboard.strings.time||"Time")+"</th>",w+="<th>"+(ffcDashboard.strings.description||"Description")+"</th>",w+="<th>"+(ffcDashboard.strings.audiences||"Audiences")+"</th>",w+="<th>"+(ffcDashboard.strings.actions||"Actions")+"</th>",w+="</tr></thead><tbody>"}var s="";if("cancelled"===e.status?s="cancelled-row":e.is_past&&(s="past-row"),w+="<tr"+(s?' class="'+s+'"':"")+">",w+="<td>"+e.environment_name,e.schedule_name&&(w+='<br><small style="color: #666;">'+e.schedule_name+"</small>"),w+="</td>",w+="<td>"+e.booking_date+"</td>",w+="<td>"+e.start_time+" - "+e.end_time+"</td>",w+="<td>"+(e.description||"")+"</td>",w+="<td>",e.audiences&&e.audiences.length>0&&e.audiences.forEach(function(e){w+='<span class="ffc-audience-tag" style="background-color: '+e.color+'; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 12px;">'+e.name+"</span>"}),w+="</td>",w+="<td>","upcoming"===t&&"cancelled"!==e.status){var i=e.audiences?e.audiences.map(function(e){return e.name}).join(", "):"",r={uid:"ffc-booking-"+e.id,summary:e.description||e.environment_name,description:(e.environment_name?(ffcDashboard.strings.environment||"Ambiente")+": "+e.environment_name:"")+(e.schedule_name?"\n"+e.schedule_name:"")+(e.description?"\n"+e.description:"")+(i?"\n"+(ffcDashboard.strings.audiences||"Audiencias")+": "+i:""),location:e.environment_name||"",date:e.booking_date_raw,startTime:e.start_time,endTime:e.end_time||e.start_time};w+=p(r)}w+="</td></tr>"}),""!==y&&(w+="</tbody></table>"),w+=this.buildPagination(v.length,a,"audience"),n.html(w),n.find(".ffc-filter-from").val(o),n.find(".ffc-filter-to").val(c),n.find(".ffc-filter-search").val(f)}else n.html(i+'<div class="ffc-empty-state"><p>'+ffcDashboard.strings.noAudienceBookings+"</p></div>")},cancelAppointment:function(t){confirm(ffcDashboard.strings.confirmCancel)&&e.ajax({url:ffcDashboard.ajaxUrl,method:"POST",data:{action:"ffc_cancel_appointment",appointment_id:t,nonce:ffcDashboard.nonce},success:function(t){t.success?(alert(ffcDashboard.strings.cancelSuccess),v._appointmentsData=null,e("#tab-appointments").html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>"),v.loadAppointments()):alert(t.data.message||ffcDashboard.strings.cancelError)},error:function(){alert(ffcDashboard.strings.cancelError)}})},loadProfile:function(){var t=e("#tab-profile");if(!(t.find(".ffc-profile-info").length>0)){t.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),e.ajax({url:a,method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v.renderProfile(e)},error:function(){t.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}},_profileData:null,renderProfile:function(t){var a=e("#tab-profile");this._profileData=t;var n=ffcDashboard.strings,s=!ffcDashboard.viewAsUserId,i='<div class="ffc-profile-info">';if(i+='<div class="ffc-profile-field">',i+="<label>"+n.name+"</label>",t.names&&t.names.length>1?(i+='<ul class="name-list">',t.names.forEach(function(e){i+="<li>"+e+"</li>"}),i+="</ul>"):t.names&&1===t.names.length?i+='<div class="value">'+t.names[0]+"</div>":i+='<div class="value">'+(t.display_name||"-")+"</div>",i+="</div>",i+='<div class="ffc-profile-field">',i+="<label>"+n.linkedEmails+"</label>",t.emails&&t.emails.length>1?(i+='<ul class="email-list">',t.emails.forEach(function(e){i+="<li>"+e+"</li>"}),i+="</ul>"):t.emails&&1===t.emails.length?i+='<div class="value">'+t.emails[0]+"</div>":i+='<div class="value">'+(t.email||"-")+"</div>",i+="</div>",i+='<div class="ffc-profile-field">',i+="<label>"+n.cpfRf+"</label>",t.cpfs_masked&&t.cpfs_masked.length>1?(i+='<ul class="cpf-list">',t.cpfs_masked.forEach(function(e){i+="<li>"+e+"</li>"}),i+="</ul>"):t.cpfs_masked&&1===t.cpfs_masked.length?i+='<div class="value">'+t.cpfs_masked[0]+"</div>":i+='<div class="value">'+(t.cpf_masked||"-")+"</div>",i+="</div>",i+='<div class="ffc-profile-field"><label>'+(n.phone||"Phone:")+"</label>",i+='<div class="value">'+(t.phone||"-")+"</div></div>",i+='<div class="ffc-profile-field"><label>'+(n.department||"Department:")+"</label>",i+='<div class="value">'+(t.department||"-")+"</div></div>",i+='<div class="ffc-profile-field"><label>'+(n.organization||"Organization:")+"</label>",i+='<div class="value">'+(t.organization||"-")+"</div></div>",t.notes&&(i+='<div class="ffc-profile-field"><label>'+(n.notesLabel||"Notes:")+"</label>",i+='<div class="value">'+u(t.notes)+"</div></div>"),t.audience_groups&&t.audience_groups.length>0&&(i+='<div class="ffc-profile-field">',i+="<label>"+(n.audienceGroups||"Groups")+"</label>",i+='<div class="value" style="display: flex; flex-wrap: wrap; gap: 6px;">',t.audience_groups.forEach(function(e){i+='<span style="background-color: '+(e.color||"#2271b1")+'; color: #fff; padding: 4px 12px; border-radius: 3px; font-size: 13px;">'+e.name+"</span>"}),i+="</div></div>"),i+='<div class="ffc-profile-field"><label>'+n.memberSince+"</label>",i+='<div class="value">'+(t.member_since||"-")+"</div></div>",i+="</div>",s&&(i+='<div class="ffc-profile-actions">',i+='<button type="button" class="button button-primary ffc-profile-edit-btn">'+(n.editProfile||"Edit Profile")+"</button>",i+='<button type="button" class="button ffc-password-toggle-btn">'+(n.changePassword||"Change Password")+"</button>",i+="</div>"),s&&(i+='<div class="ffc-password-form" style="display: none;">',i+='<div class="ffc-profile-field"><label for="ffc-current-password">'+(n.currentPassword||"Current Password")+"</label>",i+='<input type="password" id="ffc-current-password" autocomplete="current-password" /></div>',i+='<div class="ffc-profile-field"><label for="ffc-new-password">'+(n.newPassword||"New Password")+"</label>",i+='<input type="password" id="ffc-new-password" autocomplete="new-password" minlength="8" /></div>',i+='<div class="ffc-profile-field"><label for="ffc-confirm-password">'+(n.confirmPassword||"Confirm New Password")+"</label>",i+='<input type="password" id="ffc-confirm-password" autocomplete="new-password" /></div>',i+='<button type="button" class="button button-primary ffc-password-save-btn">'+(n.save||"Save")+"</button>",i+='<span class="ffc-password-status" style="margin-left: 10px;"></span>',i+="</div>"),s&&(i+='<div class="ffc-audience-join-section" id="ffc-audience-join-section"></div>',setTimeout(function(){v.loadJoinableGroups()},0)),s){var r=t.preferences||{};i+='<div class="ffc-profile-section">',i+="<h3>"+(n.notificationSection||"Notification Preferences")+"</h3>",i+='<div class="ffc-notif-list">',i+=this._buildToggle("notify_appointment_confirm",n.notifAppointmentConfirm||"Appointment confirmation",r),i+=this._buildToggle("notify_appointment_reminder",n.notifAppointmentReminder||"Appointment reminder",r),i+=this._buildToggle("notify_new_certificate",n.notifNewCertificate||"New certificate issued",r),i+="</div>",i+='<span class="ffc-notif-status" style="margin-left: 10px; color: #28a745; display: none;"></span>',i+="</div>"}s&&(i+='<div class="ffc-profile-section ffc-lgpd-section">',i+="<h3>"+(n.privacySection||"Privacy & Data (LGPD)")+"</h3>",i+='<p class="ffc-lgpd-desc">'+(n.exportDataDesc||"Request a copy of all your personal data stored in the system.")+"</p>",i+='<button type="button" class="button ffc-lgpd-export-btn">'+(n.exportData||"Export My Data")+"</button>",i+='<p class="ffc-lgpd-desc" style="margin-top: 20px;">'+(n.deletionDataDesc||"Request deletion of your personal data. An administrator will review your request.")+"</p>",i+='<button type="button" class="button ffc-lgpd-delete-btn">'+(n.requestDeletion||"Request Data Deletion")+"</button>",i+='<span class="ffc-lgpd-status" style="margin-left: 10px; display: none;"></span>',i+="</div>"),a.html(i)},_buildToggle:function(e,t,a){return'<label class="ffc-toggle-label"><input type="checkbox" class="ffc-notif-toggle" data-key="'+e+'"'+(a[e]?" checked":"")+' /><span class="ffc-toggle-switch"></span><span>'+t+"</span></label>"},showProfileEditForm:function(){var t=e("#tab-profile"),a=this._profileData;if(a){var n='<div class="ffc-profile-edit-form">';n+="<h3>"+(ffcDashboard.strings.editProfile||"Edit Profile")+"</h3>",n+='<div class="ffc-profile-field"><label for="ffc-edit-display-name">'+ffcDashboard.strings.name+"</label>",n+='<input type="text" id="ffc-edit-display-name" value="'+u(a.display_name)+'" maxlength="250" /></div>',n+='<div class="ffc-profile-field"><label for="ffc-edit-phone">'+(ffcDashboard.strings.phone||"Phone:")+"</label>",n+='<input type="tel" id="ffc-edit-phone" value="'+u(a.phone)+'" maxlength="50" /></div>',n+='<div class="ffc-profile-field"><label for="ffc-edit-department">'+(ffcDashboard.strings.department||"Department:")+"</label>",n+='<input type="text" id="ffc-edit-department" value="'+u(a.department)+'" maxlength="250" /></div>',n+='<div class="ffc-profile-field"><label for="ffc-edit-organization">'+(ffcDashboard.strings.organization||"Organization:")+"</label>",n+='<input type="text" id="ffc-edit-organization" value="'+u(a.organization)+'" maxlength="250" /></div>',n+='<div class="ffc-profile-field"><label for="ffc-edit-notes">'+(ffcDashboard.strings.notesLabel||"Notes:")+"</label>",n+='<textarea id="ffc-edit-notes" rows="3" maxlength="1000" placeholder="'+(ffcDashboard.strings.notesPlaceholder||"Personal notes...")+'">'+u(a.notes)+"</textarea></div>",n+='<div class="ffc-profile-edit-actions" style="margin-top: 15px;">',n+='<button type="button" class="button button-primary ffc-profile-save-btn">'+(ffcDashboard.strings.save||"Save")+"</button> ",n+='<button type="button" class="button ffc-profile-cancel-btn">'+(ffcDashboard.strings.cancel||"Cancel")+"</button>",n+='<span class="ffc-profile-save-status" style="margin-left: 10px; display: none;"></span>',n+="</div></div>",t.html(n)}},saveProfile:function(){var t={display_name:e("#ffc-edit-display-name").val(),phone:e("#ffc-edit-phone").val(),department:e("#ffc-edit-department").val(),organization:e("#ffc-edit-organization").val(),notes:e("#ffc-edit-notes").val()},a=e(".ffc-profile-save-btn"),n=e(".ffc-profile-save-status");a.prop("disabled",!0),n.text(ffcDashboard.strings.saving||"Saving...").show().css("color","#666"),e.ajax({url:ffcDashboard.restUrl+"user/profile",method:"PUT",contentType:"application/json",data:JSON.stringify(t),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v._profileData=null,v.renderProfile(e)},error:function(e){var t=ffcDashboard.strings.saveError||"Error saving profile";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),n.text(t).css("color","#d63638"),a.prop("disabled",!1)}})},loadJoinableGroups:function(){var t=e("#ffc-audience-join-section");0!==t.length&&e.ajax({url:ffcDashboard.restUrl+"user/joinable-groups",method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){v.renderJoinableGroups(e)},error:function(){t.empty()}})},renderJoinableGroups:function(t){var a=e("#ffc-audience-join-section"),n=t.parents||[];if(0!==n.length){var s=ffcDashboard.strings,i="<h3>"+(s.joinGroups||"Join Groups")+"</h3>";i+='<p class="ffc-audience-limit-msg">'+(s.joinGroupsDesc||"Select up to {max} groups to participate in collective calendars.").replace("{max}",t.max_groups)+"</p>",n.forEach(function(e){i+='<div class="ffc-audience-parent-group">',i+='<div class="ffc-audience-parent-header">',i+='<span class="ffc-audience-dot" style="background-color: '+(e.color||"#2271b1")+';"></span>',i+="<span>"+u(e.name)+"</span>",i+="</div>",i+='<div class="ffc-audience-children-list">',(e.children||[]).forEach(function(a){if(i+='<div class="ffc-audience-join-item'+(a.is_member?" is-member":"")+'" data-group-id="'+a.id+'">',i+='<span class="ffc-audience-name">',i+='<span class="ffc-audience-dot" style="background-color: '+(a.color||e.color||"#2271b1")+';"></span>',i+=u(a.name),i+="</span>",a.is_member)i+='<button type="button" class="button ffc-audience-leave-btn" data-id="'+a.id+'">'+(s.leaveGroup||"Leave")+"</button>";else{var n=t.joined_count>=t.max_groups?" disabled":"";i+='<button type="button" class="button button-primary ffc-audience-join-btn" data-id="'+a.id+'"'+n+">"+(s.joinGroup||"Join")+"</button>"}i+="</div>"}),i+="</div></div>"}),a.html(i)}else a.empty()},joinAudienceGroup:function(t){var a=e('.ffc-audience-join-btn[data-id="'+t+'"]');a.prop("disabled",!0).text(ffcDashboard.strings.saving||"Saving..."),e.ajax({url:ffcDashboard.restUrl+"user/audience-group/join",method:"POST",contentType:"application/json",data:JSON.stringify({group_id:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(){v._profileData=null,v._audienceData=null,v.loadProfile()},error:function(e){var t=e.responseJSON&&e.responseJSON.message||ffcDashboard.strings.error||"Error";alert(t),a.prop("disabled",!1).text(ffcDashboard.strings.joinGroup||"Join")}})},leaveAudienceGroup:function(t){if(confirm(ffcDashboard.strings.confirmLeaveGroup||"Leave this group?")){var a=e('.ffc-audience-leave-btn[data-id="'+t+'"]');a.prop("disabled",!0).text(ffcDashboard.strings.saving||"Saving..."),e.ajax({url:ffcDashboard.restUrl+"user/audience-group/leave",method:"POST",contentType:"application/json",data:JSON.stringify({group_id:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(){v._profileData=null,v._audienceData=null,v.loadProfile()},error:function(e){var t=e.responseJSON&&e.responseJSON.message||ffcDashboard.strings.error||"Error";alert(t),a.prop("disabled",!1).text(ffcDashboard.strings.leaveGroup||"Leave")}})}},changePassword:function(){var t=ffcDashboard.strings,a=e("#ffc-current-password").val(),n=e("#ffc-new-password").val(),s=e("#ffc-confirm-password").val(),i=e(".ffc-password-status");if(a&&n&&s)if(n===s)if(n.length<8)i.text(t.passwordTooShort||"Min 8 characters").css("color","#d63638");else{var r=e(".ffc-password-save-btn");r.prop("disabled",!0),i.text(ffcDashboard.strings.saving||"Saving...").css("color","#666"),e.ajax({url:ffcDashboard.restUrl+"user/change-password",method:"POST",contentType:"application/json",data:JSON.stringify({current_password:a,new_password:n}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(a){i.text(a.message||t.passwordChanged||"Password changed!").css("color","#28a745"),e("#ffc-current-password, #ffc-new-password, #ffc-confirm-password").val(""),r.prop("disabled",!1)},error:function(e){var a=t.passwordError||"Error";e.responseJSON&&e.responseJSON.message&&(a=e.responseJSON.message),i.text(a).css("color","#d63638"),r.prop("disabled",!1)}})}else i.text(t.passwordMismatch||"Passwords do not match").css("color","#d63638");else i.text(t.passwordError||"All fields required").css("color","#d63638")},privacyRequest:function(t){var a=e(".ffc-lgpd-status");a.text(ffcDashboard.strings.loading||"Loading...").css("color","#666").show(),e.ajax({url:ffcDashboard.restUrl+"user/privacy-request",method:"POST",contentType:"application/json",data:JSON.stringify({type:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){a.text(e.message||ffcDashboard.strings.privacyRequestSent||"Request sent!").css("color","#28a745")},error:function(e){var t=ffcDashboard.strings.privacyRequestError||"Error";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),a.text(t).css("color","#d63638")}})},saveNotificationPreferences:function(){var t={};e(".ffc-notif-toggle").each(function(){t[e(this).data("key")]=e(this).is(":checked")});var a=e(".ffc-notif-status");e.ajax({url:ffcDashboard.restUrl+"user/profile",method:"PUT",contentType:"application/json",data:JSON.stringify({preferences:t}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(e){e.preferences&&(v._profileData.preferences=e.preferences),a.text(ffcDashboard.strings.notifSaved||"Saved").show(),setTimeout(function(){a.fadeOut()},2e3)},error:function(){a.text(ffcDashboard.strings.saveError||"Error").css("color","#d63638").show()}})}};e(document).ready(function(){e("#ffc-user-dashboard").length>0&&v.init()})}(jQuery);