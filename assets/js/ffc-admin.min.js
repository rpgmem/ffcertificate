!function(e){"use strict";window.FFC=window.FFC||{},window.FFC.Admin=window.FFC.Admin||{},window.FFC.Admin.showNotification=function(t,n,i){n=n||"info",i=i||5e3,e(".ffc-admin-notification").remove();var o=("undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).dismiss||"Dismiss",s=e('<div class="ffc-admin-notification notice '+{success:"notice-success",error:"notice-error",warning:"notice-warning",info:"notice-info"}[n]+' is-dismissible"><p><span class="dashicons dashicons-'+{success:"yes-alt",error:"dismiss",warning:"warning",info:"info"}[n]+'"></span> '+t+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">'+o+"</span></button></div>");e(".wrap > h1").length?e(".wrap > h1").after(s):e("#wpbody-content").prepend(s),s.find(".notice-dismiss").on("click",function(){s.fadeOut(200,function(){e(this).remove()})}),i>0&&setTimeout(function(){s.fadeOut(200,function(){e(this).remove()})},i)},e(document).on("click","#ffc_btn_generate_codes",function(t){t.preventDefault();var n=e("#ffc_qty_codes").val();if(!n||isNaN(n)||n<1){var i=(o="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).enterValidNumber||"Please enter a valid number.";return e("#ffc_gen_status").text(i).css("color","red"),void e("#ffc_qty_codes").focus()}var o,s=e(this),c=e("#ffc_gen_status"),r=s.text(),a=(o="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).generating||"Generating...",f=o.generatingTickets||"Generating tickets...";s.prop("disabled",!0).text(a),c.text(f).css("color","#999");var d="undefined"!=typeof ffc_ajax?ffc_ajax.nonce:"";e.ajax({url:ajaxurl,type:"POST",data:{action:"ffc_generate_codes",qty:n,nonce:d},success:function(t){var i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{};if(t.success){var o=e("#ffc_generated_list");if(o.length){var a=o.val(),f=a?a+"\n"+t.data.codes:t.data.codes;o.val(f);var d=i.ticketsGeneratedSuccess||"tickets generated successfully!";c.text("✓ "+n+" "+d).css("color","green"),setTimeout(function(){c.text("")},5e3)}else{console.warn("[FFC] Generated codes field not found");var l=i.codesFieldNotFound||"Error: codes field not found";c.text("✗ "+l).css("color","red")}}else{var u=i.error||"Error: ";c.text("✗ "+u+(t.data||"Unknown error")).css("color","red")}s.prop("disabled",!1).text(r)},error:function(e){console.error("[FFC] AJAX error:",e.status,e.statusText,e.responseText);var t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{},n="✗ ";if(403===e.status)n+=t.permissionDenied||"Permission denied. Please reload the page.";else if(400===e.status)n+=t.badRequest||"Bad request. Check console.";else{n+=(t.serverError||"Server error (Status: %d)").replace("%d",e.status)}c.text(n).css("color","red"),s.prop("disabled",!1).text(r)}})}),e(document).on("click","#ffc-csv-export-btn",function(){var t=e(this),n=e("#ffc-csv-export-progress"),i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{},o="undefined"!=typeof ffc_ajax?ffc_ajax.export_nonce:"";if(o){var s=t.data("form-ids")||[],c=t.data("status")||"publish",r=t.text(),a=i.exportPreparing||"Preparing…";t.prop("disabled",!0).text(a),n.show().text("");var f={action:"ffc_csv_export_start",nonce:o,status:c};s&&s.length&&(f.form_ids=s),e.post(ajaxurl,f,function(s){if(!s.success)return t.prop("disabled",!1).text(r),void n.text(s.data||i.error||"Error");var c=s.data.job_id,a=s.data.total,f=i.exportProgress||"Exporting %1$d/%2$d…";!function s(){e.post(ajaxurl,{action:"ffc_csv_export_batch",nonce:o,job_id:c},function(d){if(!d.success)return t.prop("disabled",!1).text(r),void n.text(d.data||"Error");var l=d.data.processed,u=f.replace("%1$d",l).replace("%2$d",a);if(n.text(u),d.data.done){var p=ajaxurl+"?action=ffc_csv_export_download&job_id="+encodeURIComponent(c)+"&nonce="+encodeURIComponent(o),g=e("<iframe>",{src:p}).css({display:"none"}).appendTo("body");setTimeout(function(){t.prop("disabled",!1).text(r);var e=i.exportDone||"Done!";n.text("✓ "+l+"/"+a+" — "+e),setTimeout(function(){n.fadeOut()},5e3),g.remove()},2e3)}else s()}).fail(function(){t.prop("disabled",!1).text(r),n.text(i.connectionError||"Connection error.")})}()}).fail(function(){t.prop("disabled",!1).text(r),n.text(i.connectionError||"Connection error.")})}else alert(i.error||"Error: missing export nonce")}),e(document).ready(function(){e("#ffc-fields-container").length&&(window.FFC&&window.FFC.Admin&&window.FFC.Admin.FieldBuilder?window.FFC.Admin.FieldBuilder.init():console.warn("[FFC Admin] Field Builder module not loaded"))}),jQuery(document).ready(function(e){e("#ffc-migrations-overlay").length||e("body").append('<div id="ffc-migrations-overlay" class="ffc-migrations-overlay"></div>');var t=e("#ffc-migrations-btn"),n=e("#ffc-migrations-menu"),i=e("#ffc-migrations-overlay");function o(){n.removeClass("ffc-visible"),i.removeClass("ffc-visible")}function s(t,n){e(t).is(":checked")?e(n).slideDown():e(n).slideUp()}t.length&&n.length&&(t.on("click",function(t){t.preventDefault(),t.stopPropagation(),n.hasClass("ffc-visible")?o():(e(".ffc-migrations-menu").not(n).removeClass("ffc-visible"),i.addClass("ffc-visible"),n.addClass("ffc-visible"))}),i.on("click",function(e){e.preventDefault(),e.stopPropagation(),o()}),e(document).on("click",function(t){e(t.target).closest(".ffc-migrations-dropdown").length||o()}),e(document).on("keydown",function(e){"Escape"!==e.key&&27!==e.keyCode||n.hasClass("ffc-visible")&&o()}),n.on("click",function(e){e.stopPropagation()}),e(document).on("change","#ffc_restriction_password",function(){s(this,"#ffc_password_field")}),e("#ffc_restriction_password").trigger("change"),e(document).on("change","#ffc_restriction_allowlist",function(){s(this,"#ffc_allowlist_field")}),e("#ffc_restriction_allowlist").trigger("change"),e(document).on("change","#ffc_restriction_denylist",function(){s(this,"#ffc_denylist_field")}),e("#ffc_restriction_denylist").trigger("change"),e(document).on("change","#ffc_restriction_ticket",function(){s(this,"#ffc_ticket_field")}),e("#ffc_restriction_ticket").trigger("change"))});var t=document.getElementById("ffc-filter-overlay");if(t){var n=document.getElementById("ffc-open-filter-overlay");n&&n.addEventListener("click",function(){t.style.display="flex"}),t.querySelectorAll(".ffc-filter-overlay-close, .ffc-filter-overlay-backdrop").forEach(function(e){e.addEventListener("click",function(){t.style.display="none"})}),t.addEventListener("click",function(e){e.target===t&&(t.style.display="none")})}if(e("#ffc_quiz_enabled").length){function i(t){e(".ffc-quiz-setting").toggleClass("ffc-hidden",!t),e(".ffc-options-field").each(function(){var n=e(this);n.hasClass("ffc-hidden")||n.find(".ffc-quiz-points").toggleClass("ffc-hidden",!t)})}e("#ffc_quiz_enabled").on("change",function(){i(e(this).is(":checked"))}),i(e("#ffc_quiz_enabled").is(":checked"))}}(jQuery);