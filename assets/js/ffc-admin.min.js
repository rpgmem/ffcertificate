!function(e){"use strict";window.FFC=window.FFC||{},window.FFC.Admin=window.FFC.Admin||{},window.FFC.Admin.showNotification=function(t,n,o){n=n||"info",o=o||5e3,e(".ffc-admin-notification").remove();var i=("undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).dismiss||"Dismiss",s=e('<div class="ffc-admin-notification notice '+{success:"notice-success",error:"notice-error",warning:"notice-warning",info:"notice-info"}[n]+' is-dismissible"><p><span class="dashicons dashicons-'+{success:"yes-alt",error:"dismiss",warning:"warning",info:"info"}[n]+'"></span> '+t+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">'+i+"</span></button></div>");e(".wrap > h1").length?e(".wrap > h1").after(s):e("#wpbody-content").prepend(s),s.find(".notice-dismiss").on("click",function(){s.fadeOut(200,function(){e(this).remove()})}),o>0&&setTimeout(function(){s.fadeOut(200,function(){e(this).remove()})},o)},e(document).on("click","#ffc_btn_generate_codes",function(t){t.preventDefault();var n=e("#ffc_qty_codes").val();if(!n||isNaN(n)||n<1){var o=(i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).enterValidNumber||"Please enter a valid number.";return e("#ffc_gen_status").text(o).css("color","red"),void e("#ffc_qty_codes").focus()}var i,s=e(this),r=e("#ffc_gen_status"),c=s.text(),a=(i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{}).generating||"Generating...",f=i.generatingTickets||"Generating tickets...";s.prop("disabled",!0).text(a),r.text(f).css("color","#999");var d="undefined"!=typeof ffc_ajax?ffc_ajax.nonce:"";e.ajax({url:ajaxurl,type:"POST",data:{action:"ffc_generate_codes",qty:n,nonce:d},success:function(t){var o="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{};if(t.success){var i=e("#ffc_generated_list");if(i.length){var a=i.val(),f=a?a+"\n"+t.data.codes:t.data.codes;i.val(f);var d=o.ticketsGeneratedSuccess||"tickets generated successfully!";r.text("✓ "+n+" "+d).css("color","green"),setTimeout(function(){r.text("")},5e3)}else{console.warn("[FFC] Generated codes field not found");var l=o.codesFieldNotFound||"Error: codes field not found";r.text("✗ "+l).css("color","red")}}else{var u=o.error||"Error: ";r.text("✗ "+u+(t.data||"Unknown error")).css("color","red")}s.prop("disabled",!1).text(c)},error:function(e){console.error("[FFC] AJAX error:",e.status,e.statusText,e.responseText);var t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{},n="✗ ";if(403===e.status)n+=t.permissionDenied||"Permission denied. Please reload the page.";else if(400===e.status)n+=t.badRequest||"Bad request. Check console.";else{n+=(t.serverError||"Server error (Status: %d)").replace("%d",e.status)}r.text(n).css("color","red"),s.prop("disabled",!1).text(c)}})}),e(document).on("click","#ffc-csv-export-btn",function(){var t=e(this),n=e("#ffc-csv-export-progress"),o="undefined"!=typeof ffc_ajax&&ffc_ajax.strings?ffc_ajax.strings:{},i="undefined"!=typeof ffc_ajax?ffc_ajax.export_nonce:"";if(i){var s=t.data("form-ids")||[],r=t.data("status")||"publish",c=t.text(),a=o.exportPreparing||"Preparing…";t.prop("disabled",!0).text(a),n.show().text("");var f={action:"ffc_csv_export_start",nonce:i,status:r};s&&s.length&&(f.form_ids=s),e.post(ajaxurl,f,function(s){if(!s.success)return t.prop("disabled",!1).text(c),void n.text(s.data||o.error||"Error");var r=s.data.job_id,a=s.data.total,f=o.exportProgress||"Exporting %1$d/%2$d…";!function s(){e.post(ajaxurl,{action:"ffc_csv_export_batch",nonce:i,job_id:r},function(d){if(!d.success)return t.prop("disabled",!1).text(c),void n.text(d.data||"Error");var l=d.data.processed,u=f.replace("%1$d",l).replace("%2$d",a);if(n.text(u),d.data.done){var p=ajaxurl+"?action=ffc_csv_export_download&job_id="+encodeURIComponent(r)+"&nonce="+encodeURIComponent(i),_=e("<iframe>",{src:p}).css({display:"none"}).appendTo("body");setTimeout(function(){t.prop("disabled",!1).text(c);var e=o.exportDone||"Done!";n.text("✓ "+l+"/"+a+" — "+e),setTimeout(function(){n.fadeOut()},5e3),_.remove()},2e3)}else s()}).fail(function(){t.prop("disabled",!1).text(c),n.text(o.connectionError||"Connection error.")})}()}).fail(function(){t.prop("disabled",!1).text(c),n.text(o.connectionError||"Connection error.")})}else alert(o.error||"Error: missing export nonce")}),e(document).ready(function(){e("#ffc-fields-container").length&&(window.FFC&&window.FFC.Admin&&window.FFC.Admin.FieldBuilder?window.FFC.Admin.FieldBuilder.init():console.warn("[FFC Admin] Field Builder module not loaded"))}),jQuery(document).ready(function(e){e("#ffc-migrations-overlay").length||e("body").append('<div id="ffc-migrations-overlay" class="ffc-migrations-overlay"></div>');var t=e("#ffc-migrations-btn"),n=e("#ffc-migrations-menu"),o=e("#ffc-migrations-overlay");function i(){n.removeClass("ffc-visible"),o.removeClass("ffc-visible")}function s(t,n){e(t).is(":checked")?e(n).slideDown():e(n).slideUp()}t.length&&n.length&&(t.on("click",function(t){t.preventDefault(),t.stopPropagation(),n.hasClass("ffc-visible")?i():(e(".ffc-migrations-menu").not(n).removeClass("ffc-visible"),o.addClass("ffc-visible"),n.addClass("ffc-visible"))}),o.on("click",function(e){e.preventDefault(),e.stopPropagation(),i()}),e(document).on("click",function(t){e(t.target).closest(".ffc-migrations-dropdown").length||i()}),e(document).on("keydown",function(e){"Escape"!==e.key&&27!==e.keyCode||n.hasClass("ffc-visible")&&i()}),n.on("click",function(e){e.stopPropagation()}),e(document).on("change","#ffc_restriction_password",function(){s(this,"#ffc_password_field")}),e("#ffc_restriction_password").trigger("change"),e(document).on("change","#ffc_restriction_allowlist",function(){s(this,"#ffc_allowlist_field")}),e("#ffc_restriction_allowlist").trigger("change"),e(document).on("change","#ffc_restriction_denylist",function(){s(this,"#ffc_denylist_field")}),e("#ffc_restriction_denylist").trigger("change"),e(document).on("change","#ffc_restriction_ticket",function(){s(this,"#ffc_ticket_field")}),e("#ffc_restriction_ticket").trigger("change"))})}(jQuery);