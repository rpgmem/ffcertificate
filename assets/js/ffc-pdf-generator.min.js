!function(e,a){"use strict";function t(){return"undefined"==typeof html2canvas?(console.error("[FFC PDF] html2canvas library not loaded"),!1):void 0!==a.jspdf&&void 0!==a.jspdf.jsPDF||(console.error("[FFC PDF] jsPDF library not loaded"),!1)}function n(){e("#ffc-pdf-overlay").fadeOut(300,function(){e(this).remove()})}function i(i,f){if(!t()){var r="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfLibrariesFailed?ffc_ajax.strings.pdfLibrariesFailed:"PDF libraries failed to load. Please refresh the page.";return void alert(r)}const{jsPDF:o}=a.jspdf;!function(){if(!(e("#ffc-pdf-overlay").length>0)){var a=e('<div id="ffc-pdf-overlay"></div>').css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)","z-index":"999999",display:"flex","align-items":"center","justify-content":"center"}),t=e("<div></div>").css({background:"white",padding:"40px","border-radius":"8px","text-align":"center","max-width":"400px","box-shadow":"0 4px 20px rgba(0,0,0,0.3)"}),n=e('<div class="ffc-spinner"></div>').css({border:"4px solid #f3f3f3","border-top":"4px solid #2271b1","border-radius":"50%",width:"50px",height:"50px",margin:"0 auto 20px",animation:"ffc-spin 1s linear infinite"}),i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.generatingPdf?ffc_ajax.strings.generatingPdf:"undefined"!=typeof ffcCalendar&&ffcCalendar.strings&&ffcCalendar.strings.generatingPdf?ffcCalendar.strings.generatingPdf:"undefined"!=typeof ffcReceiptData&&ffcReceiptData.strings&&ffcReceiptData.strings.generatingPdf?ffcReceiptData.strings.generatingPdf:"Generating PDF...",f=e("<h3></h3>").css({margin:"0 0 10px 0",color:"#333","font-size":"18px","font-weight":"600"}).text(i),r="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pleaseWait?ffc_ajax.strings.pleaseWait:"undefined"!=typeof ffcCalendar&&ffcCalendar.strings&&ffcCalendar.strings.pleaseWait?ffcCalendar.strings.pleaseWait:"undefined"!=typeof ffcReceiptData&&ffcReceiptData.strings&&ffcReceiptData.strings.pleaseWait?ffcReceiptData.strings.pleaseWait:"Please wait, this may take a few seconds...",o=e("<p></p>").css({margin:"0",color:"#666","font-size":"14px","line-height":"1.5"}).text(r);t.append(n).append(f).append(o),a.append(t),e("body").append(a),e("#ffc-spinner-animation").length||e('<style id="ffc-spinner-animation">@keyframes ffc-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>').appendTo("head")}}();var s=Date.now(),d="portrait"===i.orientation,c=d?"794px":"1123px",l=d?"1123px":"794px",p=e('<div class="ffc-pdf-temp-container no-lazyload skip-lazy"></div>').css({position:"fixed",top:"0",left:"0",width:c,height:l,overflow:"hidden",background:"white","z-index":"999998",opacity:"0"}).appendTo("body"),g=i.html||"",h='<div class="ffc-pdf-wrapper" style="width:100%;height:100%;position:relative;">';i.bg_image&&(h+='<img src="'+i.bg_image+'" class="ffc-pdf-bg skip-lazy no-lazyload" loading="eager" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;" crossorigin="anonymous">'),h+='<div class="ffc-pdf-content" style="position:relative;z-index:1;">'+g+"</div>",h+="</div>",p.html(h),p.find("img").attr({loading:"eager",decoding:"sync"}).addClass("skip-lazy no-lazyload");var x,u=p.find("img"),v=u.length,m=0;function F(){++m>=v&&(clearTimeout(x),y())}function y(){var a=Date.now()-s,t=Math.max(0,800-a);setTimeout(function(){var a=p.find(".ffc-pdf-wrapper")[0];if(!a){console.error("[FFC PDF] Wrapper not found");var t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfContainerNotFound?ffc_ajax.strings.pdfContainerNotFound:"Error: PDF container not found";return alert(t),p.remove(),void n()}var i=d?794:1123,r=d?1123:794;e(a).css({width:i+"px",height:r+"px","max-width":i+"px","max-height":r+"px",transform:"scale(1)",overflow:"hidden","box-sizing":"border-box"}),setTimeout(function(){html2canvas(a,{scale:2,width:i,height:r,useCORS:!0,allowTaint:!1,logging:!1,backgroundColor:"#ffffff"}).then(function(e){try{for(var a=e.getContext("2d").getImageData(0,0,e.width,e.height),t=!1,i=0;i<a.data.length;i+=4){var r=a.data[i],s=a.data[i+1],c=a.data[i+2];if(255!==r||255!==s||255!==c){t=!0;break}}t||console.warn("[FFC PDF] Canvas is blank â€” check HTML/CSS.");var l=new o(d?"portrait":"landscape","mm","a4"),g=e.toDataURL("image/png",1),h=d?210:297,x=d?297:210;l.addImage(g,"PNG",0,0,h,x),l.save(f||"certificate.pdf"),p.remove(),n()}catch(e){console.error("[FFC PDF] Error:",e);var u="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.errorGeneratingPdf?ffc_ajax.strings.errorGeneratingPdf:"Error generating PDF";alert(u),p.remove(),n()}}).catch(function(e){console.error("[FFC PDF] html2canvas error:",e);var a="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.html2canvasFailed?ffc_ajax.strings.html2canvasFailed:"Error: html2canvas failed";alert(a),p.remove(),n()})},300)},t)}v>0?(x=setTimeout(function(){y()},1e4),u.each(function(){var a=this,t=e(a),n=t.attr("src");if(n&&n.startsWith("data:"))"function"==typeof a.decode?a.decode().then(function(){F()}).catch(function(){console.warn("[FFC PDF] Data URI decode failed"),F()}):a.complete&&a.naturalHeight>0?F():(t.one("load",F),t.one("error",function(){console.warn("[FFC PDF] Data URI image failed to load"),F()}));else if(a.complete&&a.naturalHeight>0)F();else if(t.one("load",function(){F()}),t.one("error",function(){console.warn("[FFC PDF] Image failed to load:",n),F()}),n){var i=a.src;a.src="",a.src=i}})):y()}a.ffcGeneratePDF=i,a.ffcPdfGenerator={generatePDF:i,checkLibraries:t}}(jQuery,window);