!function(e,a){"use strict";function t(){return"undefined"==typeof html2canvas?(console.error("[FFC PDF] html2canvas library not loaded"),!1):void 0!==a.jspdf&&void 0!==a.jspdf.jsPDF||(console.error("[FFC PDF] jsPDF library not loaded"),!1)}function i(){e("#ffc-pdf-overlay").fadeOut(300,function(){e(this).remove()})}function n(n,r){if(!t()){var f="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfLibrariesFailed?ffc_ajax.strings.pdfLibrariesFailed:"PDF libraries failed to load. Please refresh the page.";return void alert(f)}const{jsPDF:o}=a.jspdf;!function(){if(!(e("#ffc-pdf-overlay").length>0)){var a=e('<div id="ffc-pdf-overlay"></div>').css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)","z-index":"999999",display:"flex","align-items":"center","justify-content":"center"}),t=e("<div></div>").css({background:"white",padding:"40px","border-radius":"8px","text-align":"center","max-width":"400px","box-shadow":"0 4px 20px rgba(0,0,0,0.3)"}),i=e('<div class="ffc-spinner"></div>').css({border:"4px solid #f3f3f3","border-top":"4px solid #2271b1","border-radius":"50%",width:"50px",height:"50px",margin:"0 auto 20px",animation:"ffc-spin 1s linear infinite"}),n="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.generatingPdf?ffc_ajax.strings.generatingPdf:"Generating PDF...",r=e("<h3></h3>").css({margin:"0 0 10px 0",color:"#333","font-size":"18px","font-weight":"600"}).text(n),f="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pleaseWait?ffc_ajax.strings.pleaseWait:"Please wait, this may take a few seconds...",o=e("<p></p>").css({margin:"0",color:"#666","font-size":"14px","line-height":"1.5"}).text(f);t.append(i).append(r).append(o),a.append(t),e("body").append(a),e("#ffc-spinner-animation").length||e('<style id="ffc-spinner-animation">@keyframes ffc-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>').appendTo("head")}}();var s=Date.now(),d="portrait"===n.orientation,c=d?"794px":"1123px",p=d?"1123px":"794px",l=e('<div class="ffc-pdf-temp-container"></div>').css({position:"fixed",top:"0",left:"0",width:c,height:p,overflow:"hidden",background:"white","z-index":"999998",opacity:"0"}).appendTo("body"),g=n.html||"",h='<div class="ffc-pdf-wrapper" style="width:100%;height:100%;position:relative;">';n.bg_image&&(h+='<img src="'+n.bg_image+'" class="ffc-pdf-bg" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;" crossorigin="anonymous">'),h+='<div class="ffc-pdf-content" style="position:relative;z-index:1;">'+g+"</div>",h+="</div>",l.html(h);var x,v=l.find("img"),u=v.length,m=0;function F(){++m>=u&&(clearTimeout(x),j())}function j(){var a=Date.now()-s,t=Math.max(0,800-a);setTimeout(function(){var a=l.find(".ffc-pdf-wrapper")[0];if(!a){console.error("[FFC PDF] Wrapper not found");var t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfContainerNotFound?ffc_ajax.strings.pdfContainerNotFound:"Error: PDF container not found";return alert(t),l.remove(),void i()}var n=d?794:1123,f=d?1123:794;e(a).css({width:n+"px",height:f+"px","max-width":n+"px","max-height":f+"px",transform:"scale(1)",overflow:"hidden","box-sizing":"border-box"}),setTimeout(function(){html2canvas(a,{scale:2,width:n,height:f,useCORS:!0,allowTaint:!1,logging:!1,backgroundColor:"#ffffff"}).then(function(e){try{for(var a=e.getContext("2d").getImageData(0,0,e.width,e.height),t=!1,n=0;n<a.data.length;n+=4){var f=a.data[n],s=a.data[n+1],c=a.data[n+2];if(255!==f||255!==s||255!==c){t=!0;break}}t||console.warn("[FFC PDF] Canvas is blank â€” check HTML/CSS.");var p=new o(d?"portrait":"landscape","mm","a4"),g=e.toDataURL("image/png",1),h=d?210:297,x=d?297:210;p.addImage(g,"PNG",0,0,h,x),p.save(r||"certificate.pdf"),l.remove(),i()}catch(e){console.error("[FFC PDF] Error:",e);var v="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.errorGeneratingPdf?ffc_ajax.strings.errorGeneratingPdf:"Error generating PDF";alert(v),l.remove(),i()}}).catch(function(e){console.error("[FFC PDF] html2canvas error:",e);var a="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.html2canvasFailed?ffc_ajax.strings.html2canvasFailed:"Error: html2canvas failed";alert(a),l.remove(),i()})},300)},t)}u>0?(x=setTimeout(function(){j()},1e4),v.each(function(){var a=this,t=e(a),i=t.attr("src");if(a.complete&&a.naturalHeight>0)F();else if(t.one("load",function(){F()}),t.one("error",function(){console.warn("[FFC PDF] Image failed to load:",i),F()}),i&&!i.startsWith("data:")){var n=a.src;a.src="",a.src=n}})):j()}a.ffcGeneratePDF=n,a.ffcPdfGenerator={generatePDF:n,checkLibraries:t}}(jQuery,window);