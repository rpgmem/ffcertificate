!function(a,e){"use strict";function t(){return"undefined"==typeof html2canvas?(console.error("[FFC PDF] html2canvas library not loaded"),!1):void 0!==e.jspdf&&void 0!==e.jspdf.jsPDF||(console.error("[FFC PDF] jsPDF library not loaded"),!1)}function n(){a("#ffc-pdf-overlay").fadeOut(300,function(){a(this).remove()})}function i(i,r){if(!t()){var f="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfLibrariesFailed?ffc_ajax.strings.pdfLibrariesFailed:"PDF libraries failed to load. Please refresh the page.";return void alert(f)}const{jsPDF:o}=e.jspdf;!function(){if(!(a("#ffc-pdf-overlay").length>0)){var e=a('<div id="ffc-pdf-overlay"></div>').css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)","z-index":"999999",display:"flex","align-items":"center","justify-content":"center"}),t=a("<div></div>").css({background:"white",padding:"40px","border-radius":"8px","text-align":"center","max-width":"400px","box-shadow":"0 4px 20px rgba(0,0,0,0.3)"}),n=a('<div class="ffc-spinner"></div>').css({border:"4px solid #f3f3f3","border-top":"4px solid #2271b1","border-radius":"50%",width:"50px",height:"50px",margin:"0 auto 20px",animation:"ffc-spin 1s linear infinite"}),i="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.generatingPdf?ffc_ajax.strings.generatingPdf:"undefined"!=typeof ffcCalendar&&ffcCalendar.strings&&ffcCalendar.strings.generatingPdf?ffcCalendar.strings.generatingPdf:"undefined"!=typeof ffcReceiptData&&ffcReceiptData.strings&&ffcReceiptData.strings.generatingPdf?ffcReceiptData.strings.generatingPdf:"Generating PDF...",r=a("<h3></h3>").css({margin:"0 0 10px 0",color:"#333","font-size":"18px","font-weight":"600"}).text(i),f="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pleaseWait?ffc_ajax.strings.pleaseWait:"undefined"!=typeof ffcCalendar&&ffcCalendar.strings&&ffcCalendar.strings.pleaseWait?ffcCalendar.strings.pleaseWait:"undefined"!=typeof ffcReceiptData&&ffcReceiptData.strings&&ffcReceiptData.strings.pleaseWait?ffcReceiptData.strings.pleaseWait:"Please wait, this may take a few seconds...",o=a("<p></p>").css({margin:"0",color:"#666","font-size":"14px","line-height":"1.5"}).text(f);t.append(n).append(r).append(o),e.append(t),a("body").append(e),a("#ffc-spinner-animation").length||a('<style id="ffc-spinner-animation">@keyframes ffc-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>').appendTo("head")}}();var s=Date.now(),d="portrait"===i.orientation,c=d?"794px":"1123px",l=d?"1123px":"794px",p=a('<div class="ffc-pdf-temp-container no-lazyload skip-lazy"></div>').css({position:"fixed",top:"0",left:"0",width:c,height:l,overflow:"hidden",background:"white","z-index":"999998",opacity:"0"}).appendTo("body"),g=i.html||"",h='<div class="ffc-pdf-wrapper" style="width:100%;height:100%;position:relative;">';i.bg_image&&(h+='<img src="'+i.bg_image+'" class="ffc-pdf-bg skip-lazy no-lazyload" loading="eager" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;" crossorigin="anonymous">'),h+='<div class="ffc-pdf-content" style="position:relative;z-index:1;">'+g+"</div>",h+="</div>",p.html(h),p.find("img").each(function(){var e=a(this),t=e.attr("src");t&&e.attr("data-ffc-original-src",t),e.attr({loading:"eager",decoding:"sync","data-no-lazy":"1","data-skip-lazy":"1","data-exclude":"true"}).addClass("skip-lazy no-lazyload perfmatters-lazy-skip")});var u,x=p.find("img"),v=x.length,m=0;function y(){++m>=v&&(clearTimeout(u),F())}function F(){var e=Date.now()-s,t=Math.max(0,800-e);setTimeout(function(){var e=p.find(".ffc-pdf-wrapper")[0];if(!e){console.error("[FFC PDF] Wrapper not found");var t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfContainerNotFound?ffc_ajax.strings.pdfContainerNotFound:"Error: PDF container not found";return alert(t),p.remove(),void n()}var i=d?794:1123,f=d?1123:794;a(e).css({width:i+"px",height:f+"px","max-width":i+"px","max-height":f+"px",transform:"scale(1)",overflow:"hidden","box-sizing":"border-box"}),setTimeout(function(){p.css("opacity","1"),p.find("img").each(function(){var e=a(this),t=e.attr("src")||"",n=e.attr("data-ffc-original-src");if(n&&t!==n&&e.attr("src",n),!t||"about:blank"===t||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"===t){var i=e.attr("data-src")||e.attr("data-lazy-src")||e.attr("data-original")||n;i&&e.attr("src",i)}}),html2canvas(e,{scale:2,width:i,height:f,useCORS:!0,allowTaint:!1,logging:!1,backgroundColor:"#ffffff"}).then(function(a){try{for(var e=a.getContext("2d").getImageData(0,0,a.width,a.height),t=!1,i=0;i<e.data.length;i+=4){var f=e.data[i],s=e.data[i+1],c=e.data[i+2];if(255!==f||255!==s||255!==c){t=!0;break}}t||console.warn("[FFC PDF] Canvas is blank â€” check HTML/CSS.");var l=new o(d?"portrait":"landscape","mm","a4"),g=a.toDataURL("image/png",1),h=d?210:297,u=d?297:210;l.addImage(g,"PNG",0,0,h,u),l.save(r||"certificate.pdf"),p.remove(),n()}catch(a){console.error("[FFC PDF] Error:",a);var x="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.errorGeneratingPdf?ffc_ajax.strings.errorGeneratingPdf:"Error generating PDF";alert(x),p.remove(),n()}}).catch(function(a){console.error("[FFC PDF] html2canvas error:",a);var e="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.html2canvasFailed?ffc_ajax.strings.html2canvasFailed:"Error: html2canvas failed";alert(e),p.remove(),n()})},300)},t)}v>0?(u=setTimeout(function(){F()},1e4),x.each(function(){var e=this,t=a(e),n=t.attr("src");if(n&&n.startsWith("data:"))"function"==typeof e.decode?e.decode().then(function(){y()}).catch(function(){console.warn("[FFC PDF] Data URI decode failed"),y()}):e.complete&&e.naturalHeight>0?y():(t.one("load",y),t.one("error",function(){console.warn("[FFC PDF] Data URI image failed to load"),y()}));else if(e.complete&&e.naturalHeight>0)y();else if(t.one("load",function(){y()}),t.one("error",function(){console.warn("[FFC PDF] Image failed to load:",n),y()}),n){var i=e.src;e.src="",e.src=i}})):F()}e.ffcGeneratePDF=i,e.ffcPdfGenerator={generatePDF:i,checkLibraries:t}}(jQuery,window);