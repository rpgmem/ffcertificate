!function(e){"use strict";function t(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}window.ffcCalendarFrontend={selectedDate:null,selectedTime:null,calendarId:null,init:function(){this.bindEvents()},bindEvents:function(){var t=this;window.FFC&&window.FFC.Frontend&&window.FFC.Frontend.Masks&&"function"==typeof window.FFC.Frontend.Masks.applyCpfRf&&(window.FFC.Frontend.Masks.applyCpfRf(e("#ffc-booking-cpf-rf")),e(document).on("focus","#ffc-booking-cpf-rf",function(){window.FFC.Frontend.Masks.applyCpfRf(e(this))})),e(document).on("click",".ffc-timeslot:not(.ffc-timeslot-full)",function(){t.selectTimeSlot(e(this))}),e(document).on("keydown",".ffc-timeslot:not(.ffc-timeslot-full)",function(a){"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),t.selectTimeSlot(e(this)))}),e(document).on("submit","#ffc-self-scheduling-form",function(a){a.preventDefault(),t.submitBooking(e(this))}),e(document).on("click",".ffc-btn-back",function(e){e.preventDefault(),t.backToTimeSlots()}),e(document).on("click",".ffc-btn-new-booking",function(e){e.preventDefault(),t.resetCalendar()}),e(document).on("click","#ffc-self-scheduling-modal .ffc-modal-close, #ffc-self-scheduling-modal .ffc-modal-backdrop",function(){t.closeModal()}),e(document).on("click","#ffc-self-scheduling-modal .ffc-modal-content",function(e){e.stopPropagation()}),e(document).on("keydown",function(a){"Escape"===a.key&&e("#ffc-self-scheduling-modal").is(":visible")&&t.closeModal()}),e(document).on("click",".ffc-download-receipt-btn",function(t){t.preventDefault();var a=e(this).data("pdfData");if(a&&"function"==typeof window.ffcGeneratePDF){var n=a.filename||"appointment_receipt.pdf";window.ffcGeneratePDF(a,n)}})},selectTimeSlot:function(t){var a=t.data("time");e(".ffc-timeslot").removeClass("selected").attr("aria-selected","false"),t.addClass("selected").attr("aria-selected","true"),this.selectedTime=a,this.showBookingForm()},openModal:function(){var t=e("#ffc-self-scheduling-modal");this._triggerElement=document.activeElement,t.show(),e("body").css("overflow","hidden"),t.find(".ffc-modal-close").focus(),this._trapFocus(t)},closeModal:function(){e("#ffc-self-scheduling-modal").hide(),e("body").css("overflow",""),e(".ffc-booking-form-wrapper").hide(),e(".ffc-timeslots-wrapper").show(),e(".ffc-timeslot").removeClass("selected").attr("aria-selected","false"),this.selectedTime=null,this._triggerElement&&(this._triggerElement.focus(),this._triggerElement=null)},_trapFocus:function(e){e.off("keydown.focustrap").on("keydown.focustrap",function(t){if("Tab"===t.key){var a=e.find('a[href], button:not([disabled]), input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])').filter(":visible"),n=a.first()[0],f=a.last()[0];t.shiftKey&&document.activeElement===n?(t.preventDefault(),f.focus()):t.shiftKey||document.activeElement!==f||(t.preventDefault(),n.focus())}})},loadTimeSlots:function(t,a){var n=this;this.calendarId=t,this.selectedDate=a;var f=e("#ffc-timeslots-container"),o=e(".ffc-timeslots-loading");e("#ffc-self-scheduling-modal").find(".ffc-modal-title").text((ffcCalendar.strings.availableTimes||"Available Times")+" — "+n.formatDate(a)),e(".ffc-timeslots-wrapper").show(),e(".ffc-booking-form-wrapper").hide(),o.show(),f.html(""),n.openModal(),e.ajax({url:ffcCalendar.ajaxurl,type:"POST",data:{action:"ffc_get_available_slots",nonce:ffcCalendar.nonce,calendar_id:t,date:a},success:function(t){o.hide(),t.success&&t.data.slots?n.renderTimeSlots(t.data.slots):f.html("").append(e('<p class="ffc-no-slots">').text(ffcCalendar.strings.noSlots))},error:function(){o.hide(),f.html("").append(e('<p class="ffc-message ffc-message-error">').text(ffcCalendar.strings.error))}})},formatDate:function(e){var t=e.split("-");if(3!==t.length)return e;var a=parseInt(t[0],10),n=parseInt(t[1],10)-1;return parseInt(t[2],10)+" "+((ffcCalendar.strings.months||[])[n]||t[1])+" "+a},renderTimeSlots:function(t){var a=e("#ffc-timeslots-container"),n="";0!==t.length?(e.each(t,function(e,t){var a=t.available+" / "+t.total,f=0===t.available;n+='<div class="ffc-timeslot'+(f?" ffc-timeslot-full":"")+'" role="option" aria-selected="false"'+(f?"":' tabindex="0"')+(f?' aria-disabled="true"':"")+' data-time="'+t.time+'">',n+='<span class="ffc-timeslot-time">'+t.display+"</span>",n+='<span class="ffc-timeslot-available">'+a+"</span>",n+="</div>"}),a.html(n)):a.html("").append(e('<p class="ffc-no-slots">').text(ffcCalendar.strings.noSlots))},showBookingForm:function(){e("#ffc-form-date").val(this.selectedDate),e("#ffc-form-time").val(this.selectedTime),e(".ffc-timeslots-wrapper").hide(),e(".ffc-booking-form-wrapper").show(),e("#ffc-self-scheduling-modal .ffc-modal-title").text(ffcCalendar.strings.yourInformation||"Your Information"),window.FFC&&window.FFC.Frontend&&window.FFC.Frontend.Masks&&"function"==typeof window.FFC.Frontend.Masks.applyCpfRf&&window.FFC.Frontend.Masks.applyCpfRf(e("#ffc-booking-cpf-rf")),e("#ffc-self-scheduling-modal .ffc-modal-content").scrollTop(0);var t=e('#ffc-self-scheduling-form input:not([type="hidden"]):not([readonly]):visible').first();t.length&&t.focus()},submitBooking:function(t){var a=this,n=e(".ffc-form-messages"),f=t.find('button[type="submit"]');if(!f.data("submitting")&&(n.html(""),this.validateForm(t))){f.data("submitting",!0),f.prop("disabled",!0).text(ffcCalendar.strings.loading);var o=t.serialize();e.ajax({url:ffcCalendar.ajaxurl,type:"POST",data:o,timeout:3e4,success:function(e){f.data("submitting",!1),e.success?a.showConfirmation(e.data):(e.data&&e.data.refresh_captcha&&a.refreshCaptcha(e.data.new_label,e.data.new_hash),a.showError(e.data&&e.data.message||ffcCalendar.strings.error),f.prop("disabled",!1).text(ffcCalendar.strings.submit||"Book Appointment"))},error:function(e,t){f.data("submitting",!1);var n=ffcCalendar.strings.error;"timeout"===t?n=ffcCalendar.strings.timeout||"Connection timeout. Please try again.":0===e.status&&(n=ffcCalendar.strings.networkError||"Network error. Please check your connection and try again."),a.showError(n),f.prop("disabled",!1).text(ffcCalendar.strings.submit||"Book Appointment")}})}},validateForm:function(t){var a=!0;return t.find("[required]").each(function(){e(this).val()&&""!==e(this).val().trim()||(a=!1)}),e("#ffc-booking-consent").is(":checked")?!!a||(this.showError(ffcCalendar.strings.fillRequired),!1):(this.showError(ffcCalendar.strings.consentRequired),!1)},showError:function(t){e(".ffc-form-messages").html("").append(e('<div class="ffc-message ffc-message-error">').text(t));var a=e("#ffc-self-scheduling-modal .ffc-modal-content");a.scrollTop(a[0].scrollHeight)},showConfirmation:function(a){var n=this;e("#ffc-self-scheduling-modal").hide(),e("body").css("overflow","");var f='<div class="ffc-appointment-info">';f+="<p><strong>"+ffcCalendar.strings.date+":</strong> "+n.formatDate(n.selectedDate)+"</p>",f+="<p><strong>"+ffcCalendar.strings.time+":</strong> "+(n.selectedTime||"")+"</p>",f+="<p><strong>"+t(ffcCalendar.strings.name)+":</strong> "+t(e("#ffc-booking-name").val())+"</p>",f+="<p><strong>"+t(ffcCalendar.strings.email)+":</strong> "+t(e("#ffc-booking-email").val())+"</p>",a.requires_approval?f+="<p><strong>"+ffcCalendar.strings.status+":</strong> "+ffcCalendar.strings.pendingApproval+"</p>":f+="<p><strong>"+ffcCalendar.strings.status+":</strong> "+ffcCalendar.strings.confirmed+"</p>",f+="</div>",a.validation_code&&(f+='<div class="ffc-confirmation-code">',f+="<p><strong>"+(ffcCalendar.strings.validationCode||"Validation Code")+":</strong></p>",f+='<p class="ffc-code-value">'+t(a.validation_code)+"</p>",f+='<p class="ffc-code-help">'+ffcCalendar.strings.confirmationCodeHelp+"</p>",f+="</div>"),f+='<div class="ffc-receipt-actions">',a.pdf_data?(f+='<button type="button" class="ffc-btn ffc-btn-primary ffc-download-receipt-btn">',f+=ffcCalendar.strings.downloadReceipt,f+="</button>"):a.receipt_url&&(f+=' <a href="'+t(a.receipt_url)+'" class="ffc-btn ffc-btn-secondary" target="_blank">',f+=ffcCalendar.strings.downloadReceipt,f+="</a>"),f+="</div>",e(".ffc-appointment-details").html(f),a.pdf_data&&e(".ffc-download-receipt-btn").data("pdfData",a.pdf_data),e(".ffc-calendar-container").hide(),e(".ffc-confirmation-wrapper").show(),e("html, body").animate({scrollTop:e(".ffc-confirmation-wrapper").offset().top-100},500,function(){e(".ffc-confirmation-success h3").attr("tabindex","-1").focus()}),a.pdf_data&&"function"==typeof window.ffcGeneratePDF&&setTimeout(function(){var e=a.pdf_data.filename||"appointment_receipt.pdf";window.ffcGeneratePDF(a.pdf_data,e)},500)},refreshCaptcha:function(t,a){t&&a&&(e(".ffc-captcha-row .ffc-captcha-label-text").text(t),e("#ffc_captcha_hash").val(a),e("#ffc_captcha_ans").val("").focus())},backToTimeSlots:function(){e(".ffc-booking-form-wrapper").hide(),e(".ffc-timeslots-wrapper").show(),e(".ffc-timeslot").removeClass("selected"),this.selectedTime=null,e("#ffc-self-scheduling-modal .ffc-modal-title").text((ffcCalendar.strings.availableTimes||"Available Times")+" — "+this.formatDate(this.selectedDate)),e("#ffc-self-scheduling-modal .ffc-modal-content").scrollTop(0);var t=e(".ffc-timeslot:not(.ffc-timeslot-full)").first();t.length&&t.focus()},resetCalendar:function(){e(".ffc-confirmation-wrapper").hide(),e(".ffc-calendar-container").show(),e("#ffc-self-scheduling-form")[0].reset(),e(".ffc-form-messages").html(""),e(".ffc-timeslot").removeClass("selected"),e(".ffc-booking-form-wrapper").hide(),e(".ffc-timeslots-wrapper").show();var t=e('#ffc-self-scheduling-form button[type="submit"]');t.data("submitting",!1),t.prop("disabled",!1).text(ffcCalendar.strings.submit||"Book Appointment"),this.selectedDate=null,this.selectedTime=null,e("html, body").animate({scrollTop:e(".ffc-audience-calendar").offset().top-50},300)},initCalendarCore:function(){if("undefined"!=typeof ffcCalendar&&"undefined"!=typeof FFCCalendarCore){var t=this,a=e('script[id^="ffc-calendar-config-"]').first();if(a.length){var n;try{n=JSON.parse(a.text())}catch(e){return}for(var f=n.calendarId,o=n.workingDays||[],s=n.minDateHours||0,i=n.maxDateDays||30,c=[],r=0;r<7;r++)-1===o.indexOf(r)&&c.push(r);var l=new Date;s>0&&l.setHours(l.getHours()+s),l.setHours(0,0,0,0);var d=new Date;d.setDate(d.getDate()+i),d.setHours(23,59,59,999);var p={},u={},m=0,g=e("#ffc-calendar-container-"+f),h=n.calendarTitle||"",b=new FFCCalendarCore(g,{showLegend:!0,showTodayButton:!0,showFilters:!!h,minDate:l,maxDate:d,disabledDays:c,strings:ffcCalendar.strings,legendItems:[{class:"ffc-available",label:ffcCalendar.strings.available||"Available"},{class:"ffc-booked",label:ffcCalendar.strings.booked||"Booked"},{class:"ffc-holiday",label:ffcCalendar.strings.holiday||"Holiday"},{class:"ffc-closed",label:ffcCalendar.strings.closed||"Closed"}],getDayClasses:function(e,t){var a=[],n=t.getDay();if(u[e])return a;var f=t>=l,s=t<=d;return-1!==o.indexOf(n)&&f&&s&&a.push("ffc-available"),a},getDayContent:function(e,t,a){if(a)return'<span class="ffc-day-badge ffc-badge-holiday">'+(ffcCalendar.strings.holiday||"Holiday")+"</span>";var n=p[e]?p[e]:0;if(n>0){var f=ffcCalendar.strings.booking||"booking",o=ffcCalendar.strings.bookings||"bookings";return'<span class="ffc-day-badge ffc-badge-bookings">'+n+" "+(1===n?f:o)+"</span>"}return""},onMonthChange:function(t,a){!function(t,a,n){var o=++m;p={},e.ajax({url:ffcCalendar.ajaxurl,type:"POST",data:{action:"ffc_get_month_bookings",nonce:ffcCalendar.nonce,calendar_id:f,year:t,month:a},success:function(e){o===m&&(e.success&&(e.data.counts&&(p=e.data.counts),e.data.holidays&&(u=e.data.holidays,b&&(b.options.holidays=u))),n&&n())},error:function(){o===m&&n&&n()}})}(t,a,function(){b.refresh()})},onDayClick:function(a,n){e("#ffc-selected-date").val(a),t.loadTimeSlots(f,a)}});h&&g.find(".ffc-calendar-filters").html('<span class="ffc-calendar-title">'+e("<span>").text(h).html()+"</span>"),g.data("calendar",b)}}}},e(document).ready(function(){ffcCalendarFrontend.init(),ffcCalendarFrontend.initCalendarCore()})}(jQuery);