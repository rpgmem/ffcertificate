!function(o){"use strict";var t=window.ffcUrlShortener||{};function e(t,e){var a=o('<div class="ffc-shorturl-toast ffc-shorturl-toast--'+(e||"success")+'">').text(t).appendTo("body");setTimeout(function(){a.addClass("ffc-shorturl-toast--visible")},10),setTimeout(function(){a.removeClass("ffc-shorturl-toast--visible"),setTimeout(function(){a.remove()},300)},2e3)}function a(o){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(o).then(function(){e(t.i18n?t.i18n.copied:"Copied!")}).catch(function(){r(o)}):r(o)}function r(a){var r=o("<input>").val(a).appendTo("body").select();try{document.execCommand("copy"),e(t.i18n?t.i18n.copied:"Copied!")}catch(o){e(t.i18n?t.i18n.copyFailed:"Copy failed","error")}r.remove()}o(document).ready(function(){o(document).on("click",".ffc-copy-shorturl",function(t){t.preventDefault(),a(o(this).data("url"))}),o(document).on("click",".ffc-shorturl-code",function(){a(o(this).data("url"))}),o(document).on("click",".ffc-download-qr",function(a){a.preventDefault();var r=o(this),n=r.data("format"),c=r.data("code"),d=r.data("post-id"),i={action:"svg"===n?"ffc_download_qr_svg":"ffc_download_qr_png",nonce:t.nonce};d?i.post_id=d:i.code=c,r.prop("disabled",!0),o.post(t.ajaxUrl,i,function(o){r.prop("disabled",!1),o.success?function(o,t,e){for(var a=atob(o),r=new Array(a.length),n=0;n<a.length;n++)r[n]=a.charCodeAt(n);var c=new Uint8Array(r),d=new Blob([c],{type:e}),i=URL.createObjectURL(d),f=document.createElement("a");f.href=i,f.download=t,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(i)}(o.data.data,o.data.filename,o.data.mime):e(o.data?o.data.message:"Error","error")}).fail(function(){r.prop("disabled",!1),e(t.i18n?t.i18n.error:"Error","error")})}),o(document).on("click",".ffc-regenerate-shorturl",function(a){a.preventDefault();var r=t.i18n?t.i18n.confirm:"Generate a new short code?";if(confirm(r)){var n=o(this),c=n.data("post-id");n.prop("disabled",!0),o.post(t.ajaxUrl,{action:"ffc_regenerate_short_url",nonce:t.nonce,post_id:c},function(o){n.prop("disabled",!1),o.success?(e(t.i18n?t.i18n.regenerated:"Regenerated!"),window.location.reload()):e(o.data?o.data.message:"Error","error")}).fail(function(){n.prop("disabled",!1),e(t.i18n?t.i18n.error:"Error","error")})}}),o(document).on("click",".ffc-show-qr-modal",function(e){e.preventDefault();var a=o(this).data("code"),r=o(this).data("url"),n=o(this).data("title"),c=o("#ffc-qr-modal");c.find(".ffc-qr-modal__title").text(n),c.find(".ffc-qr-modal__url").text(r),c.find(".ffc-copy-shorturl").data("url",r),c.find(".ffc-download-qr").data("code",a),c.find(".ffc-qr-modal__img").hide(),c.find(".ffc-qr-modal__spinner").show(),c.show(),o.post(t.ajaxUrl,{action:"ffc_download_qr_png",nonce:t.nonce,code:a},function(o){c.find(".ffc-qr-modal__spinner").hide(),o.success?c.find(".ffc-qr-modal__img").attr("src","data:image/png;base64,"+o.data.data).show():c.find(".ffc-qr-modal__preview").html('<p style="color:#dc3232;">'+(o.data?o.data.message:"Error")+"</p>")}).fail(function(){c.find(".ffc-qr-modal__spinner").hide(),c.find(".ffc-qr-modal__preview").html('<p style="color:#dc3232;">Failed to load QR Code</p>')})}),o(document).on("click",".ffc-qr-modal__close, .ffc-qr-modal__backdrop",function(){o("#ffc-qr-modal").hide()}),o(document).on("keydown",function(t){"Escape"===t.key&&o("#ffc-qr-modal").hide()}),o("#ffc-create-short-url").on("submit",function(e){e.preventDefault();var a=o(this),r=a.find('button[type="submit"]'),n=o("#ffc-shorturl-result"),c=o("#ffc-shorturl-target").val(),d=o("#ffc-shorturl-title").val(),i=a.find("#ffc_short_url_nonce").val();r.prop("disabled",!0),o.post(t.ajaxUrl||window.ajaxurl||"/wp-admin/admin-ajax.php",{action:"ffc_create_short_url",nonce:i,target_url:c,title:d},function(t){if(r.prop("disabled",!1),t.success){var e=t.data.short_url;n.html("<strong>"+e+'</strong> <button type="button" class="button button-small ffc-copy-shorturl" data-url="'+e+'">Copy</button>').show(),o("#ffc-shorturl-target").val(""),o("#ffc-shorturl-title").val(""),setTimeout(function(){window.location.reload()},1500)}else n.html('<span style="color:#dc3232;">'+(t.data?t.data.message:"Error")+"</span>").show()}).fail(function(){r.prop("disabled",!1),n.html('<span style="color:#dc3232;">Request failed</span>').show()})})})}(jQuery);