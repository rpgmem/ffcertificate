!function(t){"use strict";var e=window.ffcReregistration&&window.ffcReregistration.strings||{};function a(a){var i=a.closest(".ffc-rereg-field"),r=i.find(".ffc-field-error"),n=t.trim(a.val()),o="";if(a.prop("required")&&!n&&(o=e.required||"Este campo é obrigatório."),!o&&n){var s=i.data("format")||a.data("format");if("cpf"===s)(function(t){if(11!==(t=t.replace(/\D/g,"")).length)return!1;if(/^(\d)\1{10}$/.test(t))return!1;for(var e=9;e<11;e++){for(var a=0,i=0;i<e;i++)a+=parseInt(t.charAt(i),10)*(e+1-i);if(a=10*a%11%10,parseInt(t.charAt(e),10)!==a)return!1}return!0})(n)||(o=e.invalidCpf||"CPF inválido.");else if("email"===s)/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||(o=e.invalidEmail||"E-mail inválido.");else if("phone"===s)/^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$/.test(n.replace(/\s+/g,""))||(o=e.invalidPhone||"Telefone inválido.");else if("custom_regex"===s){var f=i.data("regex");if(f)try{new RegExp(f).test(n)||(o=i.data("regex-msg")||e.invalidFormat||"Formato inválido.")}catch(t){}}}return i.toggleClass("has-error",!!o),r.text(o),!o}function i(e){var a={};return e.find('[name^="standard_fields["]').each(function(){var e=this.name.match(/\[(\w+)\]/)[1];a[e]=t(this).val()}),a}function r(e){var a={};return e.find('[name^="custom_fields["]').each(function(){var e=this.name.match(/\[(field_\d+)\]/)[1];"checkbox"===this.type?a[e]=this.checked?"1":"":a[e]=t(this).val()}),a}t(function(){t(document).on("click",".ffc-rereg-open-form",function(){var n,o,s=t(this).data("reregistration-id");n=s,(o=t("#ffc-rereg-form-panel")).html('<div class="ffc-loading">'+(e.loading||"Carregando formulário...")+"</div>").show(),t("html, body").animate({scrollTop:o.offset().top-40},300),t.post(ffcReregistration.ajaxUrl,{action:"ffc_get_reregistration_form",nonce:ffcReregistration.nonce,reregistration_id:n},function(n){var s;n.success?(o.html(n.data.html),function(t){t.find('[data-mask="cpf"]').on("input",function(){var t=this.value.replace(/\D/g,"").substring(0,11);t.length>9?t=t.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/,"$1.$2.$3-$4"):t.length>6?t=t.replace(/(\d{3})(\d{3})(\d{1,3})/,"$1.$2.$3"):t.length>3&&(t=t.replace(/(\d{3})(\d{1,3})/,"$1.$2")),this.value=t}),t.find('[data-mask="phone"]').on("input",function(){var t=this.value.replace(/\D/g,"").substring(0,11);t.length>6?t=t.replace(/(\d{2})(\d{4,5})(\d{4})/,"($1) $2-$3"):t.length>2&&(t=t.replace(/(\d{2})(\d{1,5})/,"($1) $2")),this.value=t}),t.find('[data-mask="cep"]').on("input",function(){var t=this.value.replace(/\D/g,"").substring(0,8);t.length>5&&(t=t.replace(/(\d{5})(\d{1,3})/,"$1-$2")),this.value=t}),t.find('[data-mask="rf"]').on("input",function(){var t=this.value.replace(/\D/g,"").substring(0,7);t.length>6?t=t.replace(/(\d{3})(\d{3})(\d{1})/,"$1.$2-$3"):t.length>3&&(t=t.replace(/(\d{3})(\d{1,3})/,"$1.$2")),this.value=t}),t.find('[data-mask="number"]').on("input",function(){this.value=this.value.replace(/\D/g,"")}),t.find('[data-mask="cin"]').on("input",function(){var t=this.value.replace(/\D/g,"").substring(0,9);t.length>8?t=t.replace(/(\d{2})(\d{3})(\d{3})(\d{1})/,"$1.$2.$3-$4"):t.length>5?t=t.replace(/(\d{2})(\d{3})(\d{1,3})/,"$1.$2.$3"):t.length>2&&(t=t.replace(/(\d{2})(\d{1,3})/,"$1.$2")),this.value=t})}(s=o),function(e){e.on("blur","input, textarea, select",function(){a(t(this))})}(s),function(a){var i,r=a.find("#ffc-divisao-setor-map");if(r.length){try{i=JSON.parse(r.text())}catch(t){return}var n=a.find("#ffc_rereg_divisao"),o=a.find("#ffc_rereg_setor");n.on("change",function(){var a=t(this).val(),r=o.val();o.empty(),a&&i[a]?(o.append('<option value="">'+(e.selectSetor||"Selecione")+"</option>"),t.each(i[a],function(t,e){var a=e===r?" selected":"";o.append('<option value="'+e+'"'+a+">"+e+"</option>")})):o.append('<option value="">'+(e.selectDivisao||"Selecione Divisão / Local")+"</option>")})}}(s),function(e){var a=e.find("#ffc_rereg_acumulo"),i=e.find(".ffc-rereg-acumulo-fields");a.on("change",function(){"Possuo"===t(this).val()?i.slideDown(200):i.slideUp(200)})}(s),function(a){a.find(".ffc-working-hours").each(function(){var i=t(this),r=i.data("target"),n=a.find("#"+r);function o(){var e=[];i.find("tbody tr").each(function(){e.push({day:parseInt(t(this).find(".ffc-wh-day").val(),10)||0,entry1:t(this).find(".ffc-wh-entry1").val()||"",exit1:t(this).find(".ffc-wh-exit1").val()||"",entry2:t(this).find(".ffc-wh-entry2").val()||"",exit2:t(this).find(".ffc-wh-exit2").val()||""})}),n.val(JSON.stringify(e))}i.on("change input","select, input",o),i.on("click",".ffc-wh-remove",function(){t(this).closest("tr").remove(),o()}),i.on("click",".ffc-wh-add",function(){var a=i.find("tbody"),r=t('<tr><td><select class="ffc-wh-day"><option value="0">'+(e.sunday||"Domingo")+'</option><option value="1">'+(e.monday||"Segunda")+'</option><option value="2">'+(e.tuesday||"Terça")+'</option><option value="3">'+(e.wednesday||"Quarta")+'</option><option value="4">'+(e.thursday||"Quinta")+'</option><option value="5">'+(e.friday||"Sexta")+'</option><option value="6">'+(e.saturday||"Sábado")+'</option></select></td><td><input type="time" class="ffc-wh-entry1"></td><td><input type="time" class="ffc-wh-exit1"></td><td><input type="time" class="ffc-wh-entry2"></td><td><input type="time" class="ffc-wh-exit2"></td><td><button type="button" class="ffc-wh-remove">&times;</button></td></tr>');a.append(r),o()})})}(s),function(a){a.find(".ffc-dependent-select").each(function(){var i,r=t(this),n=r.data("target"),o=a.find("#"+n),s=r.find(".ffc-dep-parent"),f=r.find(".ffc-dep-child"),d=r.find(".ffc-dep-groups");try{i=JSON.parse(d.text())}catch(t){return}function c(){o.val(JSON.stringify({parent:s.val()||"",child:f.val()||""}))}s.on("change",function(){var a=t(this).val();f.empty().append('<option value="">'+(e.select||"Selecione")+"</option>"),a&&i[a]&&t.each(i[a],function(t,e){f.append('<option value="'+e+'">'+e+"</option>")}),c()}),f.on("change",c)})}(s),function(a){a.on("click",".ffc-rereg-draft-btn",function(){var n=t(this),o=a.find(".ffc-rereg-status"),s=a.find('[name="reregistration_id"]').val();n.prop("disabled",!0).text(e.saving||"Salvando..."),o.text(""),t.post(ffcReregistration.ajaxUrl,{action:"ffc_save_reregistration_draft",nonce:ffcReregistration.nonce,reregistration_id:s,standard_fields:i(a),custom_fields:r(a)},function(t){n.prop("disabled",!1).text(e.saveDraft||"Salvar Rascunho"),t.success?(o.text(e.draftSaved||"Rascunho salvo.").addClass("ffc-status-ok"),setTimeout(function(){o.text("").removeClass("ffc-status-ok")},3e3)):o.text(t.data&&t.data.message?t.data.message:e.errorSaving||"Erro ao salvar rascunho.").addClass("ffc-status-err")}).fail(function(){n.prop("disabled",!1).text(e.saveDraft||"Salvar Rascunho"),o.text(e.errorSaving||"Erro ao salvar rascunho.").addClass("ffc-status-err")})})}(s),function(n){n.on("submit","#ffc-rereg-form",function(o){o.preventDefault();var s=!0;if(n.find("input[required]:visible, textarea[required]:visible, select[required]:visible").each(function(){a(t(this))||(s=!1)}),n.find("[data-format]:visible").each(function(){var e=t(this).find("input, textarea, select");e.length||(e=t(this)),e.val()&&(a(e)||(s=!1))}),s){var f=n.find(".ffc-rereg-submit-btn"),d=n.find(".ffc-rereg-status"),c=n.find('[name="reregistration_id"]').val();f.prop("disabled",!0).text(e.submitting||"Enviando..."),d.text("").removeClass("ffc-status-err ffc-status-ok"),t.post(ffcReregistration.ajaxUrl,{action:"ffc_submit_reregistration",nonce:ffcReregistration.nonce,reregistration_id:c,standard_fields:i(n),custom_fields:r(n)},function(a){a.success?(n.find("#ffc-rereg-form").replaceWith('<div class="ffc-dashboard-notice ffc-notice-info"><p>'+(a.data.message||e.submitted||"Recadastramento enviado com sucesso!")+"</p></div>"),t('.ffc-rereg-banner[data-reregistration-id="'+c+'"]').slideUp()):(f.prop("disabled",!1).text(e.submit||"Enviar"),a.data&&a.data.errors&&function(e,a){e.find(".has-error").removeClass("has-error"),e.find(".ffc-field-error").text(""),t.each(a,function(t,a){var i=e.find('[name="'+t+'"]').closest(".ffc-rereg-field");i.addClass("has-error"),i.find(".ffc-field-error").text(a)});var i=e.find(".has-error:first");i.length&&t("html, body").animate({scrollTop:i.offset().top-60},300)}(n,a.data.errors),d.text(a.data&&a.data.message?a.data.message:e.errorSubmitting||"Erro ao enviar.").addClass("ffc-status-err"))}).fail(function(){f.prop("disabled",!1).text(e.submit||"Enviar"),d.text(e.errorSubmitting||"Erro ao enviar.").addClass("ffc-status-err")})}else{n.find(".ffc-rereg-status").text(e.fixErrors||"Por favor, corrija os erros abaixo.").addClass("ffc-status-err");var l=n.find(".has-error:first");l.length&&t("html, body").animate({scrollTop:l.offset().top-60},300)}})}(s),function(e){e.on("click",".ffc-rereg-cancel-btn",function(){t("#ffc-rereg-form-panel").slideUp(200,function(){t(this).empty()})})}(s)):o.html('<div class="ffc-error">'+(n.data&&n.data.message?n.data.message:e.errorLoading||"Erro ao carregar formulário.")+"</div>")}).fail(function(){o.html('<div class="ffc-error">'+(e.errorLoading||"Erro ao carregar formulário.")+"</div>")})})})}(jQuery);