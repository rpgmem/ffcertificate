!function(e){"use strict";var t=window.ffcReregistration&&window.ffcReregistration.strings||{};function a(a){var i=a.closest(".ffc-rereg-field"),r=i.find(".ffc-field-error"),n=e.trim(a.val()),o="";if(a.prop("required")&&!n&&(o=t.required||"Este campo é obrigatório."),!o&&n){var f=i.data("format")||a.data("format");if("cpf"===f)(function(e){if(11!==(e=e.replace(/\D/g,"")).length)return!1;if(/^(\d)\1{10}$/.test(e))return!1;for(var t=9;t<11;t++){for(var a=0,i=0;i<t;i++)a+=parseInt(e.charAt(i),10)*(t+1-i);if(a=10*a%11%10,parseInt(e.charAt(t),10)!==a)return!1}return!0})(n)||(o=t.invalidCpf||"CPF inválido.");else if("email"===f)/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||(o=t.invalidEmail||"E-mail inválido.");else if("phone"===f)/^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$/.test(n.replace(/\s+/g,""))||(o=t.invalidPhone||"Telefone inválido.");else if("custom_regex"===f){var s=i.data("regex");if(s)try{new RegExp(s).test(n)||(o=i.data("regex-msg")||t.invalidFormat||"Formato inválido.")}catch(e){}}}return i.toggleClass("has-error",!!o),r.text(o),!o}function i(t){var a={};return t.find('[name^="standard_fields["]').each(function(){var t=this.name.match(/\[(\w+)\]/)[1];a[t]=e(this).val()}),a}function r(t){var a={};return t.find('[name^="custom_fields["]').each(function(){var t=this.name.match(/\[(field_\d+)\]/)[1];"checkbox"===this.type?a[t]=this.checked?"1":"":a[t]=e(this).val()}),a}e(function(){e(document).on("click",".ffc-rereg-open-form",function(){var n,o,f=e(this).data("reregistration-id");n=f,(o=e("#ffc-rereg-form-panel")).html('<div class="ffc-loading">'+(t.loading||"Carregando formulário...")+"</div>").show(),e("html, body").animate({scrollTop:o.offset().top-40},300),e.post(ffcReregistration.ajaxUrl,{action:"ffc_get_reregistration_form",nonce:ffcReregistration.nonce,reregistration_id:n},function(n){var f;n.success?(o.html(n.data.html),function(e){e.find('[data-mask="cpf"]').on("input",function(){var e=this.value.replace(/\D/g,"").substring(0,11);e.length>9?e=e.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/,"$1.$2.$3-$4"):e.length>6?e=e.replace(/(\d{3})(\d{3})(\d{1,3})/,"$1.$2.$3"):e.length>3&&(e=e.replace(/(\d{3})(\d{1,3})/,"$1.$2")),this.value=e}),e.find('[data-mask="phone"]').on("input",function(){var e=this.value.replace(/\D/g,"").substring(0,11);e.length>6?e=e.replace(/(\d{2})(\d{4,5})(\d{4})/,"($1) $2-$3"):e.length>2&&(e=e.replace(/(\d{2})(\d{1,5})/,"($1) $2")),this.value=e}),e.find('[data-mask="cep"]').on("input",function(){var e=this.value.replace(/\D/g,"").substring(0,8);e.length>5&&(e=e.replace(/(\d{5})(\d{1,3})/,"$1-$2")),this.value=e}),e.find('[data-mask="rf"]').on("input",function(){var e=this.value.replace(/\D/g,"").substring(0,7);e.length>6?e=e.replace(/(\d{3})(\d{3})(\d{1})/,"$1.$2-$3"):e.length>3&&(e=e.replace(/(\d{3})(\d{1,3})/,"$1.$2")),this.value=e}),e.find('[data-mask="cin"]').on("input",function(){var e=this.value.replace(/\D/g,"").substring(0,9);e.length>8?e=e.replace(/(\d{2})(\d{3})(\d{3})(\d{1})/,"$1.$2.$3-$4"):e.length>5?e=e.replace(/(\d{2})(\d{3})(\d{1,3})/,"$1.$2.$3"):e.length>2&&(e=e.replace(/(\d{2})(\d{1,3})/,"$1.$2")),this.value=e})}(f=o),function(t){t.on("blur","input, textarea, select",function(){a(e(this))})}(f),function(a){var i,r=a.find("#ffc-divisao-setor-map");if(r.length){try{i=JSON.parse(r.text())}catch(e){return}var n=a.find("#ffc_rereg_divisao"),o=a.find("#ffc_rereg_setor");n.on("change",function(){var a=e(this).val(),r=o.val();o.empty(),a&&i[a]?(o.append('<option value="">'+(t.selectSetor||"Selecione")+"</option>"),e.each(i[a],function(e,t){var a=t===r?" selected":"";o.append('<option value="'+t+'"'+a+">"+t+"</option>")})):o.append('<option value="">'+(t.selectDivisao||"Selecione Divisão / Local")+"</option>")})}}(f),function(t){var a=t.find("#ffc_rereg_acumulo"),i=t.find(".ffc-rereg-acumulo-fields");a.on("change",function(){"Possuo"===e(this).val()?i.slideDown(200):i.slideUp(200)})}(f),function(a){a.find(".ffc-working-hours").each(function(){var i=e(this),r=i.data("target"),n=a.find("#"+r);function o(){var t=[];i.find("tbody tr").each(function(){t.push({day:parseInt(e(this).find(".ffc-wh-day").val(),10)||0,entry1:e(this).find(".ffc-wh-entry1").val()||"",exit1:e(this).find(".ffc-wh-exit1").val()||"",entry2:e(this).find(".ffc-wh-entry2").val()||"",exit2:e(this).find(".ffc-wh-exit2").val()||""})}),n.val(JSON.stringify(t))}i.on("change input","select, input",o),i.on("click",".ffc-wh-remove",function(){e(this).closest("tr").remove(),o()}),i.on("click",".ffc-wh-add",function(){var a=i.find("tbody"),r=e('<tr><td><select class="ffc-wh-day"><option value="0">'+(t.sunday||"Domingo")+'</option><option value="1">'+(t.monday||"Segunda")+'</option><option value="2">'+(t.tuesday||"Terça")+'</option><option value="3">'+(t.wednesday||"Quarta")+'</option><option value="4">'+(t.thursday||"Quinta")+'</option><option value="5">'+(t.friday||"Sexta")+'</option><option value="6">'+(t.saturday||"Sábado")+'</option></select></td><td><input type="time" class="ffc-wh-entry1"></td><td><input type="time" class="ffc-wh-exit1"></td><td><input type="time" class="ffc-wh-entry2"></td><td><input type="time" class="ffc-wh-exit2"></td><td><button type="button" class="ffc-wh-remove">&times;</button></td></tr>');a.append(r),o()})})}(f),function(a){a.find(".ffc-dependent-select").each(function(){var i,r=e(this),n=r.data("target"),o=a.find("#"+n),f=r.find(".ffc-dep-parent"),s=r.find(".ffc-dep-child"),d=r.find(".ffc-dep-groups");try{i=JSON.parse(d.text())}catch(e){return}function c(){o.val(JSON.stringify({parent:f.val()||"",child:s.val()||""}))}f.on("change",function(){var a=e(this).val();s.empty().append('<option value="">'+(t.select||"Selecione")+"</option>"),a&&i[a]&&e.each(i[a],function(e,t){s.append('<option value="'+t+'">'+t+"</option>")}),c()}),s.on("change",c)})}(f),function(a){a.on("click",".ffc-rereg-draft-btn",function(){var n=e(this),o=a.find(".ffc-rereg-status"),f=a.find('[name="reregistration_id"]').val();n.prop("disabled",!0).text(t.saving||"Salvando..."),o.text(""),e.post(ffcReregistration.ajaxUrl,{action:"ffc_save_reregistration_draft",nonce:ffcReregistration.nonce,reregistration_id:f,standard_fields:i(a),custom_fields:r(a)},function(e){n.prop("disabled",!1).text(t.saveDraft||"Salvar Rascunho"),e.success?(o.text(t.draftSaved||"Rascunho salvo.").addClass("ffc-status-ok"),setTimeout(function(){o.text("").removeClass("ffc-status-ok")},3e3)):o.text(e.data&&e.data.message?e.data.message:t.errorSaving||"Erro ao salvar rascunho.").addClass("ffc-status-err")}).fail(function(){n.prop("disabled",!1).text(t.saveDraft||"Salvar Rascunho"),o.text(t.errorSaving||"Erro ao salvar rascunho.").addClass("ffc-status-err")})})}(f),function(n){n.on("submit","#ffc-rereg-form",function(o){o.preventDefault();var f=!0;if(n.find("input[required]:visible, textarea[required]:visible, select[required]:visible").each(function(){a(e(this))||(f=!1)}),n.find("[data-format]:visible").each(function(){var t=e(this).find("input, textarea, select");t.length||(t=e(this)),t.val()&&(a(t)||(f=!1))}),f){var s=n.find(".ffc-rereg-submit-btn"),d=n.find(".ffc-rereg-status"),c=n.find('[name="reregistration_id"]').val();s.prop("disabled",!0).text(t.submitting||"Enviando..."),d.text("").removeClass("ffc-status-err ffc-status-ok"),e.post(ffcReregistration.ajaxUrl,{action:"ffc_submit_reregistration",nonce:ffcReregistration.nonce,reregistration_id:c,standard_fields:i(n),custom_fields:r(n)},function(a){a.success?(n.find("#ffc-rereg-form").replaceWith('<div class="ffc-dashboard-notice ffc-notice-info"><p>'+(a.data.message||t.submitted||"Recadastramento enviado com sucesso!")+"</p></div>"),e('.ffc-rereg-banner[data-reregistration-id="'+c+'"]').slideUp()):(s.prop("disabled",!1).text(t.submit||"Enviar"),a.data&&a.data.errors&&function(t,a){t.find(".has-error").removeClass("has-error"),t.find(".ffc-field-error").text(""),e.each(a,function(e,a){var i=t.find('[name="'+e+'"]').closest(".ffc-rereg-field");i.addClass("has-error"),i.find(".ffc-field-error").text(a)});var i=t.find(".has-error:first");i.length&&e("html, body").animate({scrollTop:i.offset().top-60},300)}(n,a.data.errors),d.text(a.data&&a.data.message?a.data.message:t.errorSubmitting||"Erro ao enviar.").addClass("ffc-status-err"))}).fail(function(){s.prop("disabled",!1).text(t.submit||"Enviar"),d.text(t.errorSubmitting||"Erro ao enviar.").addClass("ffc-status-err")})}else{n.find(".ffc-rereg-status").text(t.fixErrors||"Por favor, corrija os erros abaixo.").addClass("ffc-status-err");var l=n.find(".has-error:first");l.length&&e("html, body").animate({scrollTop:l.offset().top-60},300)}})}(f),function(t){t.on("click",".ffc-rereg-cancel-btn",function(){e("#ffc-rereg-form-panel").slideUp(200,function(){e(this).empty()})})}(f)):o.html('<div class="ffc-error">'+(n.data&&n.data.message?n.data.message:t.errorLoading||"Erro ao carregar formulário.")+"</div>")}).fail(function(){o.html('<div class="ffc-error">'+(t.errorLoading||"Erro ao carregar formulário.")+"</div>")})}),e(document).on("click",".ffc-rereg-ficha-btn",function(){var a=e(this),i=a.data("submission-id"),r=a.text();i&&(a.prop("disabled",!0).text(t.generatingPdf||"Gerando PDF..."),e.post(ffcReregistration.ajaxUrl,{action:"ffc_download_ficha",nonce:ffcReregistration.nonce,submission_id:i},function(e){a.prop("disabled",!1).text(t.downloadFicha||r),e.success&&e.data.pdf_data?"function"==typeof window.ffcGeneratePDF?window.ffcGeneratePDF(e.data.pdf_data,e.data.pdf_data.filename||"ficha.pdf"):alert(t.errorFicha||"Gerador de PDF não disponível."):alert(e.data&&e.data.message?e.data.message:t.errorFicha||"Erro ao gerar ficha.")}).fail(function(){a.prop("disabled",!1).text(t.downloadFicha||r),alert(t.errorFicha||"Erro ao gerar ficha.")}))})})}(jQuery);