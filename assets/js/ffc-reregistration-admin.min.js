!function(n){"use strict";n(function(){n("#cb-select-all").on("change",function(){var e=n(this).is(":checked");n('input[name="submission_ids[]"]').prop("checked",e)}),n("#ffc-submissions-form").on("submit",function(e){var i=n(this).find('select[name="bulk_action"]').val(),t=n('input[name="submission_ids[]"]:checked').length;if(i&&t){if("approve"===i){var f=window.ffcReregistrationAdmin&&window.ffcReregistrationAdmin.strings?window.ffcReregistrationAdmin.strings.confirmApprove:"Approve selected submissions?";confirm(f)||e.preventDefault()}if("return_to_draft"===i){var r=window.ffcReregistrationAdmin&&window.ffcReregistrationAdmin.strings?window.ffcReregistrationAdmin.strings.confirmReturnToDraft:"Return selected submissions to draft? Users will be able to edit and resubmit.";confirm(r)||e.preventDefault()}}else e.preventDefault()}),n(document).on("click",".ffc-return-draft-btn",function(n){var e=(window.ffcReregistrationAdmin&&window.ffcReregistrationAdmin.strings||{}).confirmReturnToDraft||"Return this submission to draft? The user will be able to edit and resubmit.";confirm(e)||n.preventDefault()}),n(document).on("click",".ffc-ficha-btn",function(){var e=n(this),i=e.data("submission-id"),t=window.ffcReregistrationAdmin&&window.ffcReregistrationAdmin.strings||{};i&&(e.prop("disabled",!0).text(t.generatingPdf||"Generating PDF..."),n.post(ffcReregistrationAdmin.ajaxUrl,{action:"ffc_generate_ficha",nonce:ffcReregistrationAdmin.fichaNonce,submission_id:i},function(n){e.prop("disabled",!1).html('<span class="dashicons dashicons-media-document" style="vertical-align:middle;font-size:14px"></span> '+(t.ficha||"Record")),n.success&&n.data.pdf_data?"function"==typeof window.ffcGeneratePDF?window.ffcGeneratePDF(n.data.pdf_data,n.data.pdf_data.filename||"ficha.pdf"):alert(t.errorGenerating||"PDF generator not available."):alert(n.data&&n.data.message?n.data.message:t.errorGenerating||"Error generating ficha.")}).fail(function(){e.prop("disabled",!1).html('<span class="dashicons dashicons-media-document" style="vertical-align:middle;font-size:14px"></span> '+(t.ficha||"Record")),alert(t.errorGenerating||"Error generating ficha.")}))}),function(){var e=n(".ffc-transfer-list");if(!e.length)return;var i=JSON.parse(e.attr("data-audiences")||"[]"),t=JSON.parse(e.attr("data-selected")||"[]"),f={};i.forEach(function(n){f[n.id]=n});var r=e.find(".ffc-transfer-available .ffc-transfer-items"),a=e.find(".ffc-transfer-selected .ffc-transfer-items"),s=e.find(".ffc-transfer-hidden-inputs"),c=e.find(".ffc-transfer-search"),o=e.siblings(".ffc-transfer-member-count"),d=null;function l(){var n=(c.val()||"").toLowerCase();r.empty(),a.empty(),s.empty(),i.forEach(function(e){var i=-1!==t.indexOf(e.id),f="ffc-transfer-item"+(e.parent?" ffc-transfer-child":""),c='<span class="ffc-color-dot" style="background:'+e.color+'"></span>',o=(e.parent?"â€” ":"")+e.name,d='<div class="'+f+'" data-id="'+e.id+'">'+c+' <span class="ffc-transfer-label">'+o+"</span></div>";i?(a.append(d),s.append('<input type="hidden" name="rereg_audience_ids[]" value="'+e.id+'">')):n&&-1===e.name.toLowerCase().indexOf(n)||r.append(d)}),p()}function u(n){if(-1===t.indexOf(n)){t.push(n);var e=f[n];e&&e.children&&e.children.forEach(function(n){-1===t.indexOf(n)&&t.push(n)})}}function m(n){var e=t.indexOf(n);if(-1!==e){t.splice(e,1);var i=f[n];i&&i.children&&i.children.forEach(function(n){var e=t.indexOf(n);-1!==e&&t.splice(e,1)})}}function p(){d&&clearTimeout(d),t.length?d=setTimeout(function(){n.post(ffcReregistrationAdmin.ajaxUrl,{action:"ffc_rereg_count_members",nonce:ffcReregistrationAdmin.adminNonce,audience_ids:t},function(n){if(n.success){var e=ffcReregistrationAdmin.strings||{};o.html("<strong>"+(e.affectedUsers||"Affected users:")+"</strong> "+n.data.count)}})},300):o.html("")}e.on("click",".ffc-transfer-item",function(){n(this).toggleClass("ffc-transfer-highlight")}),r.on("dblclick",".ffc-transfer-item",function(){u(parseInt(n(this).data("id"),10)),l()}),a.on("dblclick",".ffc-transfer-item",function(){m(parseInt(n(this).data("id"),10)),l()}),e.find(".ffc-transfer-add").on("click",function(){r.find(".ffc-transfer-highlight").each(function(){u(parseInt(n(this).data("id"),10))}),l()}),e.find(".ffc-transfer-add-all").on("click",function(){i.forEach(function(n){u(n.id)}),l()}),e.find(".ffc-transfer-remove").on("click",function(){a.find(".ffc-transfer-highlight").each(function(){m(parseInt(n(this).data("id"),10))}),l()}),e.find(".ffc-transfer-remove-all").on("click",function(){t=[],l()}),c.on("input",function(){l()}),e.closest("form").on("submit",function(n){t.length||(n.preventDefault(),e.find(".ffc-transfer-selected").addClass("ffc-transfer-error"),setTimeout(function(){e.find(".ffc-transfer-selected").removeClass("ffc-transfer-error")},2e3))}),l()}()})}(jQuery);